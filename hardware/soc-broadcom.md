Broadcom SoC
============

## Raspberry Pi History

- RPi 1 uses BCM2835
  - VideoCore IV, 250MHz
  - ARM1176 (ARMv6)
- RPi 2 uses BCM2836
  - VideoCore IV, 250MHz
  - Cortex-A7 (ARMv7)
- RPi 3 uses BCM2837
  - VideoCore IV, 300MHz
  - Cortex-A53 (ARMv8)
- RPi 4 uses BCM2711
  - Video Core VI, 500MHz
  - Cortex-A72 x4 @1.8GHz (ARMv8)
- RPi 5 uses BCM2712
  - Video Core VII, 800MHz
  - Cortex-A76 x4 @2.4GHz (ARMv8.2-A)

## Power Consumption

- RPi 4 peaks at ~8W and idles at ~2.4W
- RPi 5 peaks at ~12W and idles at ~2W
  - requires active cooling to avoid throttling
  - when using a 15W power adapter, it caps the downstream usb port to 600mA
    (3W)
  - when using a 25W power adapter, it caps the downstream usb port to 1.6A
    (8W)

## Raspberry Pi: First and Second Stage Bootloaders

- <https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#eeprom-boot-flow>
- VideoCore has two main processors with differnet instruction sets
  - a VPU, dual-core dual-issue 16-way SIMD for system managements, codecs,
    etc.
  - QPUs, for 3D works
  - Linux runs on ARM CPU
- When powered on, VPU executes stage1 bootloader from SoC ROM (bootrom)
  - CPU is reset and SDRAM is disabled
  - VPU initializes SD/eMMC controller
  - VPU looks for `recovery.bin` on the first FAT partition
    - if gpt, the partition type must be ESP or MS basic data
    - `recovery.bin` is a minimal stage2 bootloader
    - its job is to reflash the real stage2 bootloader to SPI EEPROM
  - VPU looks for the stage2 bootloader in SPI EEPROM
    - this is the normal boot flow
  - otherwise, it waits and loads `recovery.bin` from USB
- VPU executes stage2 bootloader from EEPROM
  - VPU initializes more of the system, including clocks and SDRAM
  - VPU checks the config on EEPROM which affects the boot flow
    - it can load the firmware locally from SD card, USB storage, or NVMe to
      SDRAM
      - if gpt, the partition type must be ESP or MS basic data
    - it can also load the firmware over network or USB (by entering usb
      gadget mode) to SDRAM
    - if it finds `pieeprom.upd` on local storage, it updates the stage2
      bootloader on EEPROM
- <https://github.com/raspberrypi/rpi-eeprom> provides tools to update
  the second stage bootloader and to edit bootloader configs
- troubleshooting
  - if the bootloader fails to transition to the firmware, it should show a
    diagnostics screen on HDMI output
    - this can be disabled by `DISABLE_HDMI=1`
    - the bootloader seems picky on the monitor though
  - `BOOT_UART=1` instructs the bootloader to output to uart
  - `BOOT_ORDER` selects the boot order
    - 1 for sd, 2 for pxe, 4 for usb, e to stop, f to restart from first entry
    - default is 0xf41; reading from right to left, it means finding from sd
      then usb with a indefinite loop

## Raspberry Pi: Firmware

- at the end of stage2 bootloader, VPU loads the VPU firmware
 - on legacy rpis, VPU loads `bootcode.bin` which chainloads `start.elf`
 - on rpi4, VPU loads `start4.elf`
 - on rpi5, no loading is needed because the firmware is embedded in stage2
- VPU executes the firmware (`start4.elf`) from SDRAM
  - the firmware is a full RTOS based on ThreadX
  - it parses `config.txt`, with these default values
    - `cmdline=cmdline.txt`, which reads kernel cmdline from `cmdline.txt`
    - `kernel=kernel8.img`, which loads kernel from `kernel8.img` (armv8)
    - `enable_uart=0`, which disables uart by default
    - `armstub=?`, which uses armstub embedded in `start4.elf` by default
      - <https://github.com/raspberrypi/tools/tree/master/armstubs>
      - armstub starts in EL3, performs initializations, switches to EL2, and
        jumps to the kernel
      - on rpi4, `armstub8.S` is used, corresponding to `kernel8.img`
  - it loads various AP (ARM CPU) images
  - ARM CPU is out of reset and starts running
- CPU executes some initializations, armstub, and kernel
- troubleshooting
  - the firmware shows a rainbow splash screen
    - this can be disabled by `disable_splash=1`
  - `enable_uart=1` enables `/dev/ttyS0` for the kernel
- <https://github.com/raspberrypi/firmware/> is the official
  proprietary/prebuilt firmwares
  - on rpi0 to rpi3, `bootcode.bin` parses `config.txt` and loads one of the
    gpu (VideoCore) fw
    - `start.elf` is regular
    - `start_x.elf` includes extra codecs
    - `start_db.elf` includes debug
    - `start_cd.elf` is cut-down
  - on rpi4, eeprom fw parses `config.txt` and loads one of the `start4*.elf`
    gpu (VideoCore) fw
  - `fixup*.dat` are the corresponding memory layout data files?
- <https://github.com/christinaa/rpi-open-firmware> is a semi-working open
  source firmware
  - it provides vpu stage2 bootloader and firmware
  - it initializes the system similar to stage2
  - it initializes ARM to run an embedded chainloader
  - the chainloader (re-)initializes eMMC controller and loads linux kernel
  - most hw blocks do not work
- <https://github.com/pftf/RPi4> is an UEFI firmware
  - it is built from official EDK2 and backed by ARM and VMWare
  - it specifies `armstub=RPI_EFI.fd` in `config.txt`, which instructs the vpu
    firmware to use `RPI_EFI.fd` instead of the built-in one as armstub
  - `RPI_EFI.fd` can chainload any EFI bootloader (grub2, systemd-boot, linux
    kernel itself)
- <https://source.denx.de/u-boot/u-boot.git> is u-boot
  - `make rpi_4_defconfig`
  - copy `u-boot.bin` to the boot dir
  - specify `kernel=u-boot.bin` in `config.txt`

## Minimal Boot Partition

- <https://github.com/raspberrypi/firmware>
  - copy these to esp
    - `boot/start4.elf`
    - `boot/fixup4.dat`
  - if downstream kernel,
    - copy these to esp too
      - `boot/kernel8.img`
      - `boot/bcm2711-rpi-4-b.dtb`
    - `cp -r modules/<version>-v8+ /usr/lib/modules`
    - downstream kernel is needed for eeprom bootloader update
- create `config.txt` on esp
  - `auto_initramfs=1`, to load `initramfs8` as initramfs
  - `enable_uart=1`, to enable uart
- create `cmdline.txt` on esp
  - `console=ttyS0,115200 console=tty0 root=PARTUUID=... rootwait`
    - note that `UUID=...` only works with initramfs
- when using distro kernel, we need postinst hooks to copy installed kernel as
  `kernel8.img`, copy `bcm2711-rpi-4-b.dtb`, and copy generated initramfs as
  `initramfs8`

## Distros

- <https://www.raspberrypi.com/software/> is the official distro
  - `2023-12-11-raspios-bookworm-arm64-lite.img.xz` is a compressed disk image
  - MBR partition table
    - partition 1: 512MB, VFAT, mounted to `/boot/firmware`
    - partition 2: 2GB, EXT4, mounted to `/`
  - `/boot/firmware` has all the vpu firmwares, kernels, initramfs, dtbs, etc.
    - `config.txt` has
      - `dtparam=audio=on`
      - `camera_auto_detect=1`
      - `display_auto_detect=1`
      - `auto_initramfs=1`
      - `dtoverlay=vc4-kms-v3d`
      - `max_framebuffers=2`
      - `disable_fw_kms_setup=1`
      - `arm_64bit=1`
      - `disable_overscan=1`
      - `arm_boost=1`
    - `cmdline.txt` has
      - `console=serial0,115200 console=tty1`
      - `root=PARTUUID=4e639091-02 rootfstype=ext4 fsck.repair=yes rootwait`
      - `quiet init=/usr/lib/raspberrypi-sys-mods/firstboot`
  - `/etc/kernel/postinst.d/z50-raspi-firmware`
    - it copies the latest kernel (`/boot/vmlinuz-*`), initramfs
      (`/boot/initrd.img-*)`, dtbs (`/usr/lib/linux-image-*/broadcom`), and
      overlays (`/usr/lib/linux-image-*/overlays`) to `/boot/firmware` when
      it is installed
- <https://wiki.debian.org/RaspberryPi4> is debian
  - `20231109_raspi_4_bookworm.img.xz` is a compressed disk image
  - it is similar to the official distro
  - it has these firmwares
    - `bluez-firmware`
    - `firmware-brcm80211`
    - `raspi-firmware`
    - `wireless-regdb`
- <https://archlinuxarm.org/platforms/armv8/broadcom/raspberry-pi-4> is arch
  - `raspberrypi-bootloader` provides vpu bootloader and firmwares under
    `/boot`
    - <https://github.com/raspberrypi/firmware>
  - `uboot-raspberrypi` provides u-boot under `/boot`
    - `/boot/config.txt` has a single line, `enable_uart=1`
    - `/boot/kernel8.img` is actually `u-boot.bin`
    - `/boot/{mkscr,boot.scr,boot.txt}` is the boot script
    - `/boot/bcm271*.dtb`
  - `firmware-raspberrypi` provides firmwares under
    - `/usr/lib/firmware/updates/brcm`
    - `/usr/lib/firmware/updates/cypress`
  - `linux-aarch64` provides the generic kernel
  - `linux-rpi` provides the rpi-specific downstream kernel
    - <https://github.com/raspberrypi/linux>
    - it conflicts with `linux-aarch64` and `uboot-raspberrypi`
  - `rpi4-eeprom` provides the eeprom tools
    - <https://github.com/raspberrypi/rpi-eeprom>
    - `rpi-eeprom-update -a` to schedule an eeprom update
    - `rpi-eeprom-config` to view/edit the config
  - `raspberrypi-utils` provides various tools
    - <https://github.com/raspberrypi/utils>

## `/sys/firmware/devicetree`

- DT is built at kernel build time but the bootloader can patch it at runtime
- Kernel 32-bit `5.4.79-1-ARCH` with `config.txt`
  - `gpu_mem=64`
  - `dtparam=krnbt=on`
  - `dtoverlay=vc4-kms-v3d-pi4`
  - `initramfs initramfs-linux.img followkernel`
- `dtc -I fs /sys/firmware/devicetree/base` shows...
- compatible: `raspberrypi,4-model-b`
- `chosen`
  - bootargs
  - linux,initrd-start
  - linux,initrd-end
  - etc
- `reserved-memory`
  - `linux,cma`
    - compatible: `shared-dma-pool`
    - driver: `CONFIG_DMA_CMA`
- `cpus`
  - enable-method: `brcm,bcm2836-smp`
  - `cpu@0`, `cpu@1`, `cpu@2`, `cpu@3`
    - enable-method: `spin-table`
    - this means the firmware should make secondary CPUs spin, and branch to
      `cpu-release-addr` after thek kernel writes the address of
      `secondary_holding_pen` to it
- `sd_vcc_reg`, `fixedregulator_3v3`, and `fixedregulator_5v0`
  - compatible: `regulator-fixed`
  - driver: `CONFIG_REGULATOR_FIXED_VOLTAGE`
- `sd_io_1v8_reg`
  - compatible: `regulator-gpio`
  - driver: `CONFIG_REGULATOR_GPIO`
- `clocks`
  - `clk-osc` and `clk-usb`
    - compatible: `fixed-clock`
    - driver: `CONFIG_COMMON_CLK`
- `clk-108M`
  - compatible: `fixed-clock`
  - driver: `CONFIG_COMMON_CLK`
- `arm-pmu`
  - compatible: `arm,cortex-a72-pmu`
  - driver: `CONFIG_HW_PERF_EVENTS`
- `timer`
  - compatible: `arm,armv8-timer`
  - driver: `CONFIG_ARM_ARCH_TIMER`
- `leds`
  - compatible: `gpio-leds`
  - driver: `CONFIG_LEDS_GPIO`
- `phy`
  - compatible: `usb-nop-xceiv`
  - driver: `CONFIG_NOP_USB_XCEIV`
- `emmc2bus`
  - compatible: `simple-bus`
  - `emmc2`
    - compatible: `brcm,bcm2711-emmc2`
    - driver: `CONFIG_MMC_SDHCI_IPROC`
    - this is the microSD card
- `v3dbus`
  - compatible: `brcm,2711-v3d`
  - driver: `downstream CONFIG_DRM_V3D`
  - the downstream v3d driver binds to this device and is render-only without
    KMS
- `gpu`
  - compatible: `brcm,bcm2711-vc5`
  - driver: `CONFIG_DRM_VC4`
  - the vc4 driver binds to this device, and it has many component drivers
    that bind to various other devices (DPI, DSI, HDMI, HVS, PixelValve, TXP,
    V3D, VEC).
  - the vc4 driver's v3d component driver cannot not drive the v3d device on
    RPi4 (it can on RPi 1,2,3).  As such, it is KMS-only without rendering.
- `scb`
  - compatible: `simple-bus`
  - `ethernet`
    - compatible: `brcm,bcm2711-genet-v5`
    - driver: `CONFIG_BCMGENET`
  - `pcie`
    - compatible: `brcm,bcm2711-pcie`
    - driver: `CONFIG_PCIE_BRCMSTB`
  - `xhci`
    - compatible: `generic-xhci`
    - driver: `CONFIG_USB_XHCI_PLATFORM`
    - status: `disabled` (because it is on PCIe bus, not on platform bus)
  - `dma`
    - compatible: `brcm,bcm2711-dma`
    - driver: `downstream CONFIG_DMA_BCM2835`
  - `rpivid-local-intc`
    - compatible: `raspberrypi,rpivid-local-intc`
    - driver: `downstream rpivid-mem`
  - `vp9-decoder`
    - compatible: `raspberrypi,rpivid-vp9-decoder`
    - driver: `downstream rpivid-mem`
  - `hevc-decoder`
    - compatible: `raspberrypi,rpivid-hevc-decoder`
    - driver: `downstream rpivid-mem`
  - `h264-decoder`
    - compatible: `raspberrypi,rpivid-h264-decoder`
    - driver: `downstream rpivid-mem`
- `soc`
  - compatible: `simple-bus`
  - `watchdog`
    - compatible: `brcm,bcm2835-pm`
    - driver: `CONFIG_ARCH_BCM2835`
    - controls power domains, reset lines, and a watchdog timer
    - takes `BCM2835_CLOCK_{V3D,PERI_IMAGE,H264,ISP}` as inputs and outputs
      `BCM2835_POWER_DOMAIN_*`
  - `power`
    - compatible: `raspberrypi,bcm2835-power`
    - driver: `CONFIG_RASPBERRYPI_POWER`
    - outputs `RPI_POWER_DOMAIN_*`
  - `cprman`
    - compatible: `brcm,bcm2711-cprman`
    - driver: `CONFIG_CLK_BCM2835`
    - takes external oscillator as input and outputs `BCM2835_CLOCK_*` clocks
  - `aux`
    - compatible: `brcm,bcm2835-aux`
    - driver: `CONFIG_CLK_BCM2835`
    - takes `BCM2835_CLOCK_VPU` as input and outputs `BCM2835_AUX_CLOCK_*`
  - `clock`
    - compatible: `brcm,brcm2711-dvp`
    - driver: `CONFIG_CLK_BCM2711_DVP`
  - `interrupt-controller`
    - compatible: `arm,gic-400`
    - driver: `CONFIG_ARM_GIC`
  - `local_intc`
    - compatible: `brcm,bcm2836-l1-intc`
    - driver: `CONFIG_ARCH_BCM2835`
    - per-cpu interrupt controller for timer, PMU, IPIs
  - `mailbox`
    - compatible: `brcm,bcm2835-mbox`
    - driver: `CONFIG_BCM2835_MBOX`
  - `mailbox`
    - compatible: `brcm,bcm2711-vchiq`
    - driver: `downstream CONFIG_BCM2835_VCHIQ`
    - `bcm2835_audio`
      - compatible: `brcm,bcm2835-audio`
      - driver: `downstream?`
      - status: disabled
  - `firmware`
    - compatible: `raspberrypi,bcm2835-firmware`
    - driver: `CONFIG_RASPBERRYPI_FIRMWARE`
    - `clocks`
      - compatible: `raspberrypi,firmware-clocks`
      - driver: `CONFIG_CLK_RASPBERRYPI`
    - `gpio`
      - compatible: `raspberrypi,firmware-gpio`
      - driver: `CONFIG_GPIO_RASPBERRYPI_EXP`
  - `timer`
    - compatible: `brcm,bcm2835-system-timer`
    - driver: `CONFIG_BCM2835_TIMER`
    - a freerunning counter plus 4 timer channels
  - `dma`
    - compatible: `brcm,bcm2835-dma`
    - driver: `CONFIG_DMA_BCM2835`
    - up to 16 channels
  - `rng`
    - compatible: `brcm,bcm2711-rng200`
    - driver: `CONFIG_HW_RANDOM_IPROC_RNG200`
  - `usb`
    - compatible: `brcm,bcm2708-usb`
    - driver: `downstream?`
    - status: disabled
  - `axiperf`
    - compatible: `brcm,bcm2835-axiperf`
    - driver: `downstream?`
    - status: disabled
    - AXI performance monitor
  - `avs-monitor`
    - compatible: `brcm,bcm2711-avs-monitor`
    - driver: `none?`
    - `thermal`
      - compatible: `brcm,bcm2711-thermal`
      - driver: `CONFIG_BCM2711_THERMAL`
  - `serial`
    - compatible: `arm,pl011`
    - driver: `CONFIG_SERIAL_AMBA_PL011`
    - this is `/dev/ttyAMA0`
    - `bluetooth`
      - compatible: `brcm,bcm43438-bt`
      - driver: `CONFIG_BT_HCIUART_BCM`
  - `serial`
    - compatible: `brcm,bcm2835-aux-uart`
    - driver: `CONFIG_SERIAL_8250_BCM2835AUX`
    - this is `/dev/ttyS0`
    - `bluetooth`
      - compatible: `brcm,bcm43438-bt`
      - driver: `CONFIG_BT_HCIUART_BCM`
      - status: disabled
  - `serial` * 4
    - compatible: `arm,pl011`
    - driver: `CONFIG_SERIAL_AMBA_PL011`
    - status: disabled
  - `csi` * 2
    - compatible: `brcm,bcm2835-unicam`
    - driver: `downstream?`
    - status: disabled
  - `mmcnr`
    - compatible: `brcm,bcm2835-mmc`
    - driver: `downstream mmc-bcm2835`
    - this connects to BCM4345/6 over SDIO
  - `mmc`
    - compatible: `brcm,bcm2835-mmc`
    - driver: `downstream?`
    - status: disabled
  - `mmc`
    - compatible: `brcm,bcm2835-sdhost`
    - driver: `CONFIG_MMC_BCM2835`
    - status: disabled
  - `gpio`
    - compatible: `brcm,bcm2711-gpio`
    - driver: `CONFIG_PINCTRL_BCM2835`
    - followed by a lot of pin definitions
    - a combined GPIO controller, GPIO interrupt controller, and a
      pinmux/control device
    - takes `BCM2835_CLOCK_PWM` as input
  - `gpiomem`
    - compatible: `brcm,bcm2835-gpiomem`
    - driver: `downstream gpiomem-bcm2835`
  - `i2c0mux`
    - compatible: `i2c-mux-pinctrl`
    - driver: `CONFIG_I2C_MUX_PINCTRL`
    - status: disabled
  - `i2c` * 2
    - compatible: `brcm,bcm2711-hdmi-i2c`
    - driver: `CONFIG_I2C_BRCMSTB`
  - `i2c` * 6
    - compatible: `brcm,bcm2711-i2c`
    - driver: `CONFIG_I2C_BCM2835`
    - status: disabled
  - `spi` * 2
    - compatible: `brcm,bcm2835-aux-spi`
    - driver: `CONFIG_SPI_BCM2835AUX`
    - status: one ok and one disabled
    - takes `BCM2835_AUX_CLOCK_SPI[1-2]` as inputs
  - `spi` * 5
    - compatible: `brcm,bcm2835-spi`
    - driver: `CONFIG_SPI_BCM2835`
    - status: disabled
    - `spidev`, for one of the `spi`
      - compatible: `spidev`
      - driver: `downstream?`
  - `i2s`
    - compatible: `brcm,bcm2835-i2s`
    - driver: `CONFIG_SND_BCM2835_SOC_I2S`
    - status: disabled
    - takes `BCM2835_CLOCK_PCM` as input
  - `smi`
    - compatible: `brcm,bcm2835-smi`
    - driver: `downstream?`
    - status: disabled
    - Secondary Memory Interface
  - `pwm` * 2
    - compatible: `brcm,bcm2835-pwm`
    - driver: `CONFIG_PWM_BCM2835`
    - status: disabled
    - takes `BCM2835_CLOCK_PWM` as input
    - controls power to motors, etc.
  - `vcsm`
    - compatible: `raspberrypi,bcm2835-vcsm`
    - driver: `downstream bcm2835-vcsm`
  - `fb`
    - compatible: `brcm,bcm2708-fb`
    - driver: `downstream?`
    - status: disabled
  - `firmwarekms`
    - compatible: `raspberrypi,rpi-firmware-kms-2711`
    - driver: `downstream CONFIG_DRM_VC4`
    - status: disabled
    - vc4 is modified to do KMS over firmware dismanx instead of registers
  - `txp`
    - compatible: `brcm,bcm2835-txp`
    - driver: `CONFIG_DRM_VC4`
  - `hvs`
    - compatible: `brcm,bcm2835-hvs`
    - driver: `CONFIG_DRM_VC4`
  - `pixelvalve` * 5
    - compatible: `brcm,bcm2711-pixelvalve.`
    - driver: `CONFIG_DRM_VC4`
  - `vec`
    - compatible: `brcm,bcm2835-vec`
    - driver: `CONFIG_DRM_VC4`
    - status: disabled
  - `hdmi` * 2
    - compatible: `brcm,bcm2711-hdmi.`
    - driver: `CONFIG_DRM_VC4`
  - `dsi` * 2
    - compatible: `brcm,bcm2835-dsi.`
    - driver: `CONFIG_DRM_VC4`
    - status: disabled
    - takes `BCM2835_PLLD_DSI1` and `BCM2835_CLOCK_DSI1[EP]` as inputs
  - `dpi`
    - compatible: `brcm,bcm2835-dpi`
    - driver: `CONFIG_DRM_VC4`
    - status: disabled
    - takes `BCM2835_CLOCK_{VPU,DPI}` as inputs

## `/sys/bus`

- `amba` bus
  - `fe201000.serial` driven by `uart-pl011`
- `cec` bus
  - HDMI consumer electronics control
  - `cec[0-1]`
- `clockevents` bus
  - `clockevent[0-3]`
  - `broadcast`
- `clocksource` bus
  - `clocksource0`
- `cpu` bus
  - `cpu[0-3]`
- `event_source` bus
  - `armv7_cortex_a15`
  - `kprobe`
  - `tracepoint`
  - etc
- `gpio` bus
  - `gpiochip[0-1]`
- `i2c` bus
  - `i2c-[11-12]`
- `mdio_bus` bus
  - `unimac-mdio`
- `media` bus
  - `media[0-1]`
- `mmc` bus
  - `mmc[0-1]:*`
- `nvmem` bus
- `pci` bus
  - one driven by `pcieport`
  - another driven by `xhci_hcd`
- `pci_express` bus
  - one driven by `pcie_pme` for power management
  - another driven by `aer` for advanced error reporting
- `platform` bus
  - `3e2fd000.framebuffer` driven by `simple-framebuffer`
  - `arm-pmu` driven by `armv7-pmu`
  - `bcm2835-camera`
  - `bcm2835-power` driven by `bcm2835-power`
  - `bcm2835-wdt` driven by `bcm2835-wdt`
  - `cpufreq-dt` driven by `cpufreq-dt`
  - `fd500000.pcie` driven by `brcm-pcie`
  - `fd580000.ethernet` driven by `bcmgenet`
  - `fd5d2000.avs-monitor:thermal` driven by `bcm2711_thermal`
  - `fe003000.timer`
  - `fe004000.txp` driven by `vc4_txp`
  - `fe007000.dma` and `fe007b00.dma` driven by `bcm2835-dma`
  - `fe00b880.mailbox` driven by `bcm2835-mbox`
  - `fe100000.watchdog` driven by `bcm2835-pm`
  - `fe101000.cprman` driven by `bcm2835-clk`
  - `fe104000.rng` driven by `iproc-rng200`
  - `fe200000.gpio` driven by `pinctrl-bcm2835`
  - `fe200000.gpiomem` driven by `gpiomem-bcm2835`
  - `fe215000.aux` driven by `bcm2835-aux-clk`
  - `fe300000.mmcnr` driven by `mmc-bcm2835`
  - `fe340000.emmc2` driven by `sdhci-iproc`
  - `fe400000.hvs` driven by `vc4_hvs`
  - `feb00000.hevc-decoder`, `feb10000.rpivid-local-intc`,
    `feb20000.h264-decoder`, and `feb30000.vp9-decoder` driven by `rpivid-mem`
  - `fec00000.v3d` driven by `v3d`
  - `fe206000.pixelvalve`, `fe207000.pixelvalve`, `fe20a000.pixelvalve`,
    `fe216000.pixelvalve` and `fec12000.pixelvalve` driven by `vc4_crtc`
  - `fef00000.clock` driven by `brcm2711-dvp`
  - `fef00700.hdmi` and `fef05700.hdmi` driven by `vc4_hdmi`
  - `fef04500.i2c` and `fef09500.i2c` driven by `brcmstb-i2c`
  - `ff800000.local_intc`
  - `fixedregulator_3v3`, `fixedregulator_5v0`, and `sd_vcc_reg` driven by
    `reg-fixed-voltage`
  - `gpu` driven by `vc4-drm`
  - `kgdboc` driven by `kgdboc`
  - `leds` driven by `leds-gpio`
  - `phy`
  - `raspberrypi-cpufreq` driven by `raspberrypi-cpufreq`
  - `reg-dummy` driven by `reg-dummy`
  - `regulatory.0`
  - `sd_io_1v8_reg` driven by `gpio-regulator`
  - `snd-soc-dummy` driven by `snd-soc-dummy`
  - `timer`
  - `unimac-mdio.-19` driven by `unimac-mdio`
- `platform` bus (talk to VC firmware)
  - `bcm2835-codec` driven by `bcm2835-codec`
  - `bcm2835-isp` driven by `bcm2835-isp`
  - `fe00b840.mailbox` driven by `bcm2835_vchiq`
  - `raspberrypi-hwmon` driven by `raspberrypi-hwmon`
  - `soc:firmware` driven by `raspberrypi-firmware`
  - `soc:firmware:clocks` driven by `raspberrypi-clk`
  - `soc:firmware:gpio` driven by `raspberrypi-exp-gpio`
  - `soc:power` driven by `raspberrypi-power`
  - `soc:vcsm` driven by `bcm2835-vcsm`
  - `vcsm-cma` driven by `vcsm-cma`
- `sdio` bus
  - `mmc1:0001:[1-3]` driven by `brcmfmac`
- `serial` bus
  - `serial0-0` driven by `hci_uart_bcm`
- `usb` bus
  - some devices driven by `hub` or `usb`

## More Devices

- lsusb
  - one 5G/s root hub driven by `xhci_hcd/4p`
  - one 480M/s root hub driven by `xhci_hcd/1p`
- lspci
  - one Broadcom pci bridge driven by `pcieport`
  - one VIA VL805 usb 3.0 controller driven by `xhci_hcd`
- 6 uarts
  - <https://www.raspberrypi.org/documentation/configuration/uart.md>
  - uart 0 is `/dev/ttyAMA0` driven by `amba-pl011`
  - uart 1 is `/dev/ttyS0`
  - uart [2-5] is disabled by default
- one BT/WIFI controller
  - the WIFI part is driven by `brcmfmac`
  - add `dtparam=krnbt=on` to `config.txt` to enable the BT part in DT and
    allow `btbcm` to drive it
  - otherwise, use `btattach` in userspace to attach `/dev/ttyAMA0`
- one GPU
  - managed by propriertary driver by default
  - add `dtoverlay=vc4-kms-v3d-pi4` to `config.txt` to enable the device in DT
    and allow `vc4` and `v3d` to drive it
  - `vc4` drives the display part
  - `v3d` drives the 3D part
- no RTC
  - get time from NTP

## Unused drivers

- BCM2835 VCHIQ firmware service
  - compatible: brcm,bcm283[5-6]-vchiq
  - driver: `CONFIG_BCM2835_VCHIQ`
  - can potentially support brcm,bcm2711-vchiq?
- BCM2835 Thermal Sensor
  - compatible: brcm,bcm283[5-7]-thermal
  - driver: `CONFIG_BCM2835_THERMAL`
  - replaced by `CONFIG_BCM2711_THERMAL`
- BCM2835 Random number generator
  - compatible: brcm,bcm2835-rng
  - driver: `CONFIG_HW_RANDOM_BCM2835`
  - replaced by `CONFIG_HW_RANDOM_IPROC_RNG200`
- BCM2835 Top-Level ("ARMCTRL") Interrupt Controller
  - up to 72 interrupt sources
  - compatible: brcm,bcm283[5-6]-armctrl-ic
  - driver: `CONFIG_ARCH_BCM2835`
  - replaced by `CONFIG_ARM_GIC`?
- Raspberry Pi VideoCore firmware reset
  - compatible: raspberrypi,firmware-reset
  - driver: `CONFIG_RESET_RASPBERRYPI`
  - ???
- BCM2835 VideoCore V3D GPU
  - compatible: brcm,bcm2835-v3d
  - driver: `CONFIG_DRM_VC4`
  - replaced by `CONFIG_DRM_V3D`

## PXE

- update EEPROM and `BOOT_ORDER`
  - <https://github.com/raspberrypi/rpi-eeprom>
  - extrat config from fw file (or eeprom)
  - edit `BOOT_ORDER`
  - apply config to fw file (or eeprom)
  - flash
- eeprom looks for "Raspberry Pi Boot" PXE boot option
  - with dnsmasq, specify `--pxe-service=0,"Raspberry Pi Boot"`
- it fetches these files with empty `config.txt`
  - <https://github.com/raspberrypi/firmware>
  - `config.txt`
  - `start4.elf`
  - `fixup4.dat`
  - `bcm2711-rpi-4-b.dtb`
  - `overlays/overlay_map.dtb`
  - `cmdline.txt`
  - `kernel7l.img`

## Partitioning

- see <../distros/disk.md>
- need to update to the latest eeprom for GPT support

## Booting (Raspberry Pi)

- `kernel/head.S`
  - `_head` defined in `head.S` defines the 64-byte image header
  - the first instruction is `b primary_entry`
  - after some setup and enabling MMU, it jumps to `start_kernel`
  - dtb address is saved to `__fdt_pointer`
- `start_kernel`
  - dmesg `Booting Linux on physical CPU ...`
    - `smp_setup_processor_id`
  - dmesg `Linux version ...`
    - `linux_banner`
  - `setup_arch` is arch-specific
    - dmesg `Machine model: ...`
      - `setup_machine_fdt`
    - dmesg `Reserved memory: create CMA memory pool at ...` and
      `OF: reserved mem:...`
      - `arm64_memblock_init`
      - `early_init_fdt_scan_reserved_mem`
      - `__reserved_mem_init_node`
      - `rmem_cma_setup`
    - dmesg `Zone ranges:` to `%s zone: %lu pages`
      - `bootmem_init`,
      - `zone_sizes_init`
      - `free_area_init`
    - DEBUG dmesg `cpu logical map 0x%llx`
      - `smp_init_cpus`
      - `of_parse_and_init_cpus`
    - DEBUG dmesg `mask of set bits 0x3` and
      `MPIDR hash: aff0[0] aff1[6] aff2[14] aff3[30] mask[0x3] bits[2]`
      - `smp_build_mpidr_hash`
  - dmesg `percpu: Embedded 30 pages/cpu s82008 r8192 d32680 u122880` and
    `pcpu-alloc: s82008 r8192 d32680 u122880 alloc=30*4096`
    - `setup_per_cpu_areas`
  - dmesg `Detected PIPT I-cache on CPU0`
    - `smp_prepare_boot_cpu`
    - `cpuinfo_store_boot_cpu`
    - `__cpuinfo_store_cpu`
    - `cpuinfo_detect_icache_policy`
  - dmesg `CPU features: detected: Spectre-v2` and others
    - `smp_prepare_boot_cpu`
    - `cpuinfo_store_boot_cpu`
    - `init_cpu_features`
    - `setup_boot_cpu_capabilities`
    - `update_cpu_capabilities`
  - dmesg `Built 1 zonelists, mobility grouping on.  Total pages: 996912`
    - `build_all_zonelists`
  - dmesg `Kernel command line:`
    - `saved_command_line`
  - dmesg `Dentry cache hash table entries:` and `Inode-cache hash table entries:`
    - `vfs_caches_init_early`
  - `mm_init`
    - dmesg `mem auto-init: stack:off, heap alloc:off, heap free:off`
      - `report_meminit`
    - dmesg `software IO TLB: mapped [mem ...-...] (64MB)`
      - `mem_init`
      - `swiotlb_init`
      - `swiotlb_init_with_tbl`
      - `swiotlb_print_info`
    - dmesg `Memory: 3818092K/4050944K available (10494K kernel code, 1698K rwdata, 2384K rodata, 5888K init, 587K bss, 167316K reserved, 65536K cma-reserved`
      - `mem_init`
      - `mem_init_print_info`
    - dmesg `SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1`
      - `kmem_cache_init`
  - dmesg `ftrace: allocating ...`
    - `ftrace_init`
  - dmesg `rcu: Hierarchical RCU implementation.` and others
    - `rcu_init`
    - `rcu_bootup_announce`
  - dmesg `NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0`
    - `early_irq_init`
  - dmesg `GIC: Using split EOI/Deactivate mode`
    - `init_IRQ`
    - `irqchip_init`
    - `of_irq_init`
    - `gic_of_init`
    - `__gic_init_bases`
  - dmesg `random: get_random_bytes called from ...`
  - dmesg `arch_timer: cp15 timer(s) running at 54.00MHz (phys).`
    - `time_init`
    - `timer_probe`
    - `arch_timer_of_init`
    - `arch_timer_common_init`
    - `arch_timer_banner`
  - dmesg `clocksource: arch_sys_counter: mask: 0xffffffffffffff ...`
    - `time_init`
    - `timer_probe`
    - `arch_timer_of_init`
    - `arch_timer_common_init`
    - `arch_counter_register`
    - `clocksource_register_hz`
    - `__clocksource_register_scale`
    - `__clocksource_update_freq_scale`
  - dmesg `sched_clock: 56 bits at 54MHz, resolution 18ns, wraps every 4398046511102ns`
    - `time_init`
    - `timer_probe`
    - `arch_timer_of_init`
    - `arch_timer_common_init`
    - `arch_counter_register`
    - `sched_clock_register`
  - dmesg `Console: colour dummy device 80x25` and `printk: console [tty0] enabled`
    - `console_init`
    - `con_init`
  - dmesg `Calibrating delay loop (skipped), value calculated using timer frequency.. 108.50 BogoMIPS ...`
    - `calibrate_delay`
  - dmesg `pid_max: default: 32768 minimum: 301`
    - `pid_idr_init`
  - dmesg `Mount-cache hash table entries: ...` and `Mountpoint-cache hash table entries: ...`
    - `vfs_caches_init`
    - `mnt_init`
  - `arch_call_rest_init`
    - `rest_init`
    - spawns a thread to run `kernel_init` and goes into idle
- `kernel_init_freeable` called by `kernel_init`
  - dmesg `CPU0: cluster 0 core 0 thread -1 mpidr 0x00000080000000`
    - `smp_prepare_cpus`
    - `store_cpu_topology`
  - `do_pre_smp_initcalls`
    - call all `early_initcall()`, including
    - `trace_init_flags_sys_enter`
    - `trace_init_flags_sys_exit`
    - `cpu_suspend_init`
    - `asids_init`
    - `spawn_ksoftirqd`
    - `migration_init`
    - `srcu_bootup_announce`
    - `rcu_spawn_core_kthreads`
    - `rcu_spawn_gp_kthread`
    - `check_cpu_stall_init`
    - `rcu_sysrq_init`
    - `cpu_stop_init`
    - `init_events`
    - `init_trace_printk`
    - `event_trace_enable_again`
    - `initialize_ptr_random`
    - `its_pmsi_init`
    - `its_pci_msi_init`
    - `dummy_timer_register`
  - `smp_init`
    - dmesg `smp: Bringing up secondary CPUs ...`
    - dmesg `Detected PIPT I-cache on CPU1`
        - the boot CPU
          - `bringup_nonboot_cpus`
          - `cpu_up`
          - `_cpu_up`
          - `cpuhp_up_callbacks`
          - `cpuhp_invoke_callback`
          - `bringup_cpu`
          - `__cpu_up`
          - `boot_secondary`
          - `smp_spin_table_cpu_boot`
          - `write_pen_release`
        - the secondary CPUs
          - `secondary_holding_pen`
          - `secondary_startup`
          - `__secondary_switched`
          - `secondary_start_kernel`
          - `cpuinfo_store_cpu`
            - `__cpuinfo_store_cpu`
            - `cpuinfo_detect_icache_policy`
          - dmesg `CPU1: cluster 0 core 1 thread -1 mpidr 0x00000080000001`
            - `secondary_start_kernel`
            - `store_cpu_topology`
          - dmesg `CPU1: Booted secondary processor 0x0000000001 [0x410fd083]`
            - `secondary_start_kernel`
    - dmesg `smp: Brought up 1 node, 4 CPUs`
    - `smp_cpus_done`
      - dmesg `SMP: Total of 4 processors activated.`
      - dmesg `CPU features: detected: 32-bit EL0 Support` and `CPU features: detected: CRC32 instructions`
        - `setup_cpu_features`
        - `setup_system_capabilities`
        - `update_cpu_capabilities`
      - dmesg `CPU: All CPU(s) started at EL2`
        - `hyp_mode_check`
      - dmesg `alternatives: patching kernel code`
        - `apply_alternatives_all`
        - `__apply_alternatives_multi_stop`
        - `__apply_alternatives`
  - dmesg `devtmpfs: initialized`
    - `do_basic_setup`
    - `driver_init`
    - `devtmpfs_init`
- `do_initcalls` called by `do_basic_setup`
  - `pure_initcall()`s
    - `ipc_ns_init`
    - `init_mmap_min_addr`
    - `pci_realloc_setup_params`
    - `net_ns_init`
  - `core_initcall()`s
    - `fpsimd_init`
    - `tagged_addr_init`
    - `enable_mrs_emulation`
    - `armv8_deprecated_init`
    - `map_entry_trampoline`
    - `alloc_frozen_cpus`
    - `cpu_hotplug_pm_sync_init`
    - `wq_sysfs_init`
    - `ksysfs_init`
    - `schedutil_gov_init`
    - `pm_init`
    - `rcu_set_runtime_mode`
    - `rcu_spawn_tasks_rude_kthread`
    - `dma_init_reserved_memory`
    - `init_jiffies_clocksource`
    - `futex_init`
    - `cgroup_wq_init`
    - `cgroup1_wq_init`
    - `ftrace_mod_cmd_init`
    - `init_graph_trace`
    - `cpu_pm_init`
    - `init_zero_pfn`
    - `cma_init_reserved_areas`
    - `fsnotify_init`
    - `filelock_init`
    - `init_script_binfmt`
    - `init_elf_binfmt`
    - `init_compat_elf_binfmt`
    - `debugfs_init`
    - `tracefs_init`
    - `register_xor_blocks`
    - `prandom_init_early`
    - `pinctrl_init`
    - `gpiolib_dev_init`
    - `regulator_init`
    - `iommu_init`
    - `component_debug_init`
    - `genpd_bus_init`
    - `soc_bus_register`
    - `register_cpufreq_notifier`
    - `opp_debug_init`
    - `cpufreq_core_init`
    - `cpufreq_gov_performance_init`
    - `cpufreq_dt_platdev_init`
    - `cpuidle_init`
    - `sock_init`
    - `net_inuse_init`
    - `net_defaults_init`
    - `init_default_flow_dissectors`
    - `netpoll_init`
    - `netlink_proto_init`
    - `genl_init`
  - `postcore_initcall()`s
    - `debug_monitors_init`
    - `irq_sysfs_init`
    - `dma_atomic_pool_init`
    - `release_early_probes`
    - `bdi_class_init`
    - `mm_sysfs_init`
    - `init_per_zone_wmark_min`
    - `mpi_init`
    - `kobject_uevent_init`
    - `pcibus_class_init`
    - `pci_driver_init`
    - `amba_init`
    - `tty_class_init`
    - `vtconsole_class_init`
    - `serdev_init`
    - `iommu_dev_init`
    - `mipi_dsi_bus_init`
    - `devlink_class_init`
    - `software_node_init`
    - `wakeup_sources_debugfs_init`
    - `wakeup_sources_sysfs_init`
    - `regmap_initcall`
    - `spi_init`
    - `i2c_init`
    - `thermal_init`
    - `init_menu`
  - `arch_initcall()`s
    - `reserve_memblock_reserved_regions`
    - `aarch32_alloc_vdso_pages`
    - `vdso_init`
    - `arch_hw_breakpoint_init`
    - `asids_update_limit`
    - `cryptomgr_init`
    - `dma_channel_table_init`
    - `dma_bus_init`
    - `iommu_dma_init`
    - `of_platform_default_populate_init`
  - `subsys_initcall()`s
    - `topology_init`
    - `uid_cache_init`
    - `param_sysfs_init`
    - `user_namespace_sysctl_init`
    - `time_ns_init`
    - `cgroup_sysfs_init`
    - `cgroup_namespaces_init`
    - `user_namespaces_init`
    - `oom_init`
    - `default_bdi_init`
    - `percpu_enable_async`
    - `kcompactd_init`
    - `init_user_reserve`
    - `init_admin_reserve`
    - `init_reserve_notifier`
    - `swap_init_sysfs`
    - `swapfile_init`
    - `hugepage_init`
    - `io_wq_init`
    - `rsa_init`
    - `crypto_cmac_module_init`
    - `hmac_module_init`
    - `crypto_null_mod_init`
    - `sha256_generic_mod_init`
    - `blake2b_mod_init`
    - `crypto_ecb_module_init`
    - `crypto_ctr_module_init`
    - `crypto_gcm_module_init`
    - `crypto_ccm_module_init`
    - `aes_init`
    - `crc32c_mod_init`
    - `xxhash_mod_init`
    - `drbg_init`
    - `ghash_mod_init`
    - `ecdh_init`
    - `init_bio`
    - `blk_settings_init`
    - `blk_ioc_init`
    - `blk_mq_init`
    - `genhd_device_init`
    - `raid6_select_algo`
    - `gpiolib_debugfs_init`
    - `pwm_debugfs_init`
    - `pwm_sysfs_init`
    - `pci_slot_init`
    - `fbmem_init`
    - `regulator_fixed_voltage_init`
    - `gpio_regulator_init`
    - `misc_init`
    - `iommu_subsys_init`
    - `vga_arb_device_init`
    - `register_cpu_capacity_sysctl`
    - `dma_buf_init`
    - `phy_init`
    - `usb_common_init`
    - `usb_init`
    - `serio_init`
    - `input_init`
    - `rtc_init`
    - `power_supply_class_init`
    - `hwmon_init`
    - `mmc_init`
    - `leds_init`
    - `arm_pmu_hp_init`
    - `nvmem_init`
    - `init_soundcore`
    - `alsa_sound_init`
    - `proto_init`
    - `net_dev_init`
    - `neigh_init`
    - `fib_notifier_init`
    - `ethnl_init`
    - `nexthop_init`
    - `bt_init`
    - `ieee80211_init`
    - `rfkill_init`
    - `watchdog_init`
  - `fs_initcall()`s
    - `create_debug_debugfs_entry`
    - `clocksource_done_booting`
    - `tracer_init_tracefs`
    - `init_trace_printk_function_export`
    - `init_graph_tracefs`
    - `init_dynamic_event`
    - `init_uprobe_trace`
    - `init_pipe_fs`
    - `inotify_user_setup`
    - `eventpoll_init`
    - `anon_inode_init`
    - `proc_locks_init`
    - `iomap_init`
    - `proc_cmdline_init`
    - `proc_consoles_init`
    - `proc_cpuinfo_init`
    - `proc_devices_init`
    - `proc_interrupts_init`
    - `proc_loadavg_init`
    - `proc_meminfo_init`
    - `proc_stat_init`
    - `proc_uptime_init`
    - `proc_version_init`
    - `proc_softirqs_init`
    - `proc_kmsg_init`
    - `proc_page_init`
    - `init_ramfs_fs`
    - `blk_scsi_ioctl_init`
    - `dynamic_debug_init_control`
    - `simplefb_init`
    - `chr_dev_init`
    - `firmware_class_init`
    - `sysctl_core_init`
    - `eth_offload_init`
    - `ipv4_offload_init`
    - `inet_init`
    - `af_unix_init`
    - `ipv6_offload_init`
    - `cfg80211_init`
    - `pci_apply_final_quirks`
  - `rootfs_initcall()`s
    - `populate_rootfs`
  - `device_initcall()`s
    - `register_arm64_panic_block`
    - `cpuinfo_regs_init`
    - `armv8_pmu_driver_init`
    - `arch_init_uprobes`
    - `proc_execdomains_init`
    - `register_warn_debugfs`
    - `cpuhp_sysfs_init`
    - `ioresources_init`
    - `init_sched_debug_procfs`
    - `irq_pm_init_ops`
    - `timekeeping_init_ops`
    - `init_clocksource_sysfs`
    - `init_timer_list_procfs`
    - `alarmtimer_init`
    - `init_posix_timers`
    - `clockevents_init_sysfs`
    - `sched_clock_syscore_init`
    - `proc_modules_init`
    - `kallsyms_init`
    - `pid_namespaces_init`
    - `ikconfig_init`
    - `seccomp_sysctl_init`
    - `utsname_sysctl_init`
    - `init_tracepoints`
    - `perf_event_sysfs_init`
    - `system_trusted_keyring_init`
    - `kswapd_init`
    - `extfrag_debug_init`
    - `mm_compute_batch_init`
    - `slab_proc_init`
    - `workingset_init`
    - `proc_vmalloc_init`
    - `memblock_init_debugfs`
    - `procswaps_init`
    - `slab_sysfs_init`
    - `fcntl_init`
    - `proc_filesystems_init`
    - `start_dirtytime_writeback`
    - `blkdev_init`
    - `dio_init`
    - `aio_setup`
    - `io_uring_init`
    - `init_devpts_fs`
    - `init_fat_fs`
    - `init_vfat_fs`
    - `init_exfat_fs`
    - `init_nls_cp437`
    - `init_nls_iso8859_1`
    - `init_nls_utf8`
    - `fuse_init`
    - `ipc_init`
    - `ipc_sysctl_init`
    - `init_mqueue_fs`
    - `key_proc_init`
    - `crypto_algapi_init`
    - `jent_mod_init`
    - `calibrate_xor_blocks`
    - `asymmetric_key_init`
    - `x509_key_init`
    - `proc_genhd_init`
    - `bsg_init`
    - `deadline_init`
    - `kyber_init`
    - `libcrc32c_mod_init`
    - `percpu_counter_startup`
    - `bcm2835_pinctrl_driver_init`
    - `rpi_exp_gpio_driver_init`
    - `bcm2835_pwm_driver_init`
    - `pci_proc_init`
    - `brcm_pcie_driver_init`
    - `of_fixed_factor_clk_driver_init`
    - `of_fixed_clk_driver_init`
    - `gpio_clk_driver_init`
    - `clk_dvp_driver_init`
    - `bcm2835_clk_driver_init`
    - `bcm2835_aux_clk_driver_init`
    - `raspberrypi_clk_driver_init`
    - `bcm2835_dma_driver_init`
    - `bcm2835_power_driver_init`
    - `rpi_power_driver_init`
    - `rpi_reset_driver_init`
    - `reset_simple_driver_init`
    - `n_null_init`
    - `pty_init`
    - `hwrng_modinit`
    - `bcm2835_rng_driver_init`
    - `iproc_rng200_driver_init`
    - `cavium_rng_pf_driver_init`
    - `cavium_rng_vf_driver_init`
    - `drm_kms_helper_init`
    - `drm_core_init`
    - `topology_sysfs_init`
    - `cacheinfo_sysfs_init`
    - `bcm2835_pm_driver_init`
    - `bcm2835_spi_driver_init`
    - `bcm2835aux_spi_driver_init`
    - `net_olddevs_init`
    - `blackhole_netdev_init`
    - `phy_module_init`
    - `phy_module_init`
    - `fixed_mdio_bus_init`
    - `unimac_mdio_driver_init`
    - `bcmgenet_driver_init`
    - `brcmfmac_module_init`
    - `xhci_hcd_init`
    - `xhci_pci_init`
    - `serport_init`
    - `input_leds_init`
    - `evdev_init`
    - `bcm2835_i2c_driver_init`
    - `brcmstb_i2c_driver_init`
    - `rpi_hwmon_driver_init`
    - `bcm2835_thermal_driver_init`
    - `bcm2835_wdt_driver_init`
    - `hci_uart_init`
    - `dt_cpufreq_platdrv_init`
    - `raspberrypi_cpufreq_driver_init`
    - `arm_idle_init`
    - `mmc_pwrseq_simple_driver_init`
    - `mmc_pwrseq_emmc_driver_init`
    - `mmc_blk_init`
    - `sdhci_drv_init`
    - `sdhci_pltfm_drv_init`
    - `sdhci_iproc_driver_init`
    - `rpi_firmware_driver_init`
    - `smccc_soc_init`
    - `hid_init`
    - `hid_generic_init`
    - `a4_driver_init`
    - `apple_driver_init`
    - `belkin_driver_init`
    - `ch_driver_init`
    - `ch_driver_init`
    - `cp_driver_init`
    - `ez_driver_init`
    - `ite_driver_init`
    - `ks_driver_init`
    - `lg_driver_init`
    - `lg_g15_driver_init`
    - `ms_driver_init`
    - `mr_driver_init`
    - `redragon_driver_init`
    - `hid_init`
    - `vchiq_driver_init`
    - `bcm2835_alsa_driver_init`
    - `bcm2835_mbox_driver_init`
    - `alsa_timer_init`
    - `alsa_pcm_init`
    - `snd_soc_init`
    - `sock_diag_init`
    - `gre_offload_init`
    - `sysctl_ipv4_init`
    - `tunnel4_init`
    - `inet_diag_init`
    - `tcp_diag_init`
    - `cubictcp_register`
    - `inet6_init`
    - `sit_init`
    - `packet_init`
  - `late_initcall()`s
    - `init_oops_id`
    - `sched_init_debug`
    - `cpu_latency_qos_init`
    - `pm_debugfs_init`
    - `printk_late_init`
    - `init_srcu_module_notifier`
    - `swiotlb_create_debugfs`
    - `tk_debug_sleep_time_init`
    - `load_system_certificate_list`
    - `fault_around_debugfs`
    - `max_swapfiles_check`
    - `split_huge_pages_debugfs`
    - `check_early_ioremap_leak`
    - `init_btrfs_fs`
    - `init_root_keyring`
    - `blk_timeout_init`
    - `prandom_init_late`
    - `pci_resource_alignment_sysfs_init`
    - `pci_sysfs_init`
    - `amba_deferred_retry`
    - `clk_debug_init`
    - `sync_state_resume_initcall`
    - `deferred_probe_initcall`
    - `genpd_power_off_unused`
    - `genpd_debug_init`
    - `init_netconsole`
    - `of_fdt_raw_init`
    - `tcp_congestion_default`
    - `regulatory_init_db`
    - `init_amu_fie`
    - `clear_boot_tracer`
    - `clk_disable_unused`
    - `regulator_init_complete`
    - `of_platform_sync_state_init`
    - `alsa_sound_last_init`
- `kernel_init`
  - dmesg `Warning: unable to open an initial console.`
    - `kernel_init_freeable`
    - `console_on_rootfs`
  - dmesg `Freeing unused kernel memory: 5888K`
    - `free_initmem`
    - `free_reserved_area`
  - dmesg `Run /init as init process`
    - `run_init_process`
