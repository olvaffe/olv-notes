MediaTek SoCs
=============

## Series

- Helio A, 2018-2020
  - 12nm
  - Cortex-A53
  - PowerVR GE8300
- Helio P, 2015-2020
  - 28nm, 16nm, 12nm
  - Cortex-A53, A73
  - Mali-T860, Mali-T880, Mali-G71, Mali-G72, PowerVR GE8320
- Helio G
  - 2020, G25 / MT6762G, 12nm, Cortex-A53, PowerVR GE8320
  - 2020, G35 / MT6765,  12nm, Cortex-A53, PowerVR GE8320
  - 2023, G36 / MT6765V, 12nm, Cortex-A53, PowerVR GE8320
  - 2021, G37 / MT6765H, 12nm, Cortex-A53, PowerVR GE8320
  - 2020, G70 / MT6769V, 12nm, Cortex-{A75,A55}, Mali-G52 MC2
  - 2020, G80 / MT6769,  12nm, Cortex-{A75,A55}, Mali-G52 MC2
  - 2024, G81 / MT????,  12nm, Cortex-{A75,A55}, Mali-G52 MC2
  - 2020, G85 / MT6769Z, 12nm, Cortex-{A75,A55}, Mali-G52 MC2
  - 2021, G88 / MT6769,  12nm, Cortex-{A75,A55}, Mali-G52 MC2
  - 2019, G90 / MT6785V, 12nm, Cortex-{A76,A55}, Mali-G76 MC4
  - 2024, G91 / MT6769G, 12nm, Cortex-{A75,A55}, Mali-G52 MC2
  - 2020, G95 / MT6785,  12nm, Cortex-{A76,A55}, Mali-G76 MC4
  - 2021, G96 / MT6781,  12nm, Cortex-{A76,A55}, Mali-G57 MC2
  - 2022, G99 / MT6789,   6nm, Cortex-{A76,A55}, Mali-G57 MC2
  - 2024, G100 / MT6789,  6nm, Cortex-{A76,A55}, Mali-G57 MC2
- Dimensity ~2022
  - 2021, Dimensity  700 / MT6833, 7nm, Cortex-{A76,A55}, Mali-G57 MC2
  - 2020, Dimensity  720 / MT6853, 7nm, Cortex-{A76,A55}, Mali-G57 MC3
  - 2020, Dimensity  800 / MT6873, 7nm, Cortex-{A76,A55}, Mali-G57 MC4
  - 2021, Dimensity  810 / MT6833, 6nm, Cortex-{A76,A55}, Mali-G57 MC2
  - 2020, Dimensity  820 / MT6875, 7nm, Cortex-{A76,A55}, Mali-G57 MC5
  - 2021, Dimensity  900 / MT6877, 6nm, Cortex-{A78,A55}, Mali-G68 MC4
  - 2021, Dimensity  920 / MT6877, 6nm, Cortex-{A78,A55}, Mali-G68 MC4
  - 2022, Dimensity  930 / MT6855, 6nm, Cortex-{A78,A55}, IMG BXM-8-256
  - 2020, Dimensity 1000 / MT6889, 7nm, Cortex-{A77,A55}, Mali-G77 MC9
  - 2022, Dimensity 1050 / MT6879, 6nm, Cortex-{A78,A55}, Mali-G610 MC3
  - 2022, Dimensity 1080 / MT6877, 6nm, Cortex-{A78,A55}, Mali-G68 MC4
  - 2021, Dimensity 1100 / MT6891, 7nm, Cortex-{A77,A55}, Mali-G77 MC9
  - 2021, Dimensity 1200 / MT6893, 6nm, Cortex-{A78,A55}, Mali-G77 MC9
  - 2022, Dimensity 1300 / MT6893, 6nm, Cortex-{A78,A55}, Mali-G77 MC9
- Dimensity 2023~
  - 2023, Dimensity 6020 (700 renamed)
  - 2023, Dimensity 6080 (810 renamed)
  - 2023, Dimensity 6100+/ MT6835,  6nm, Cortex-{A76,A55}, Mali-G57 MC2
  - 2024, Dimensity 6300 / MT6835T, 6nm, Cortex-{A76,A55}, Mali-G57 MC2
  - 2023, Dimensity 7020 (930 renamed)
  - 2024, Dimensity 7025 / MT6855,  6nm, Cortex-{A78,A55}, IMG BXM-8-256
  - 2023, Dimensity 7030 (1050 renamed)
  - 2023, Dimensity 7050 (1080 renamed)
  - 2023, Dimensity 7200 / MT6886,  4nm, Cortex-{A715,A510}, Mali-G610 MC4
  - 2024, Dimensity 7300 / MT6878,  4nm, Cortex-{A78,A55}, Mali-G615 MC2
  - 2024, Dimensity 7350 / MT????,  4nm, Cortex-{A715,A510}, Mali-G610 MC4
  - 2022, Dimensity 8000 / MT6895,  4nm, Cortex-{A78,A55}, Mali-G610 MC6
  - 2023, Dimensity 8020 (1100 renamed)
  - 2023, Dimensity 8050 (1300 renamed)
  - 2022, Dimensity 8100 / MT6895,  4nm, Cortex-{A78,A55}, Mali-G610 MC6
  - 2022, Dimensity 8200 / MT6896,  4nm, Cortex-{A78,A55}, Mali-G610 MC6
  - 2024, Dimensity 8250 / MT????,  4nm, Cortex-{A78,A55}, Mali-G610 MC6
  - 2023, Dimensity 8300 / MT6897,  4nm, Cortex-{A715,A510}, Mali-G615 MC6
  - 2021, Dimensity 9000 / MT6983,  4nm, Cortex-{X2,A710,A510}, Mali-G710 MC10
  - 2022, Dimensity 9000+ / MT6983, 4nm, Cortex-{X2,A710,A510}, Mali-G710 MC10
  - 2022, Dimensity 9200 / MT6985,  4nm, Cortex-{X3,A715,A510}, Immortalis-G715 MC11
  - 2023, Dimensity 9200+ / MT6985, 4nm, Cortex-{X3,A715,A510}, Immortalis-G715 MC11
  - 2023, Dimensity 9300 / MT6989,  4nm, Cortex-{X4,A720}, Immortalis-G720 MC12
  - 2024, Dimensity 9300+ / MT????, 4nm, Cortex-{X4,A720}, Immortalis-G720 MC12
  - 2024, Dimensity 9400 / MT????,  3nm, Cortex-{X925,X4,A720}, Immortalis-G925 MC12
- Kompanio (for Chromebooks)
  - 2015, MT8173, 28nm, Cortex-{A72,A53}, PowerVR GX6250
    - cros: oak
  - 2019, Kompanio 500 / MT8183,  12nm, Cortex-{A73,A53}, Mali-G72 MP3
    - cros: kukui, jacuzzi
  - 2022, Kompanio 520 / MT8186,  12nm, Cortex-{A76,A55}, Mali-G52 MC2
    - cros: corsola
    - `mt8186-corsola-steelix-sku131073.dts`
  - 2022, Kompanio 528 / MT8186T, 12nm, Cortex-{A76,A55}, Mali-G52 MC2
  - 2022, Kompanio 800T / MT????,  6nm, Cortex-{A76,A55}, Mali-G57 MC2
  - 2021, Kompanio 820 / MT8192,   7nm, Cortex-{A76,A55}, Mali-G57 MC5
  - 2021, Kompanio 828 / MT81??,   7nm, Cortex-{A76,A55}, Mali-G57 MC5
    - cros: asurada
  - 2024, Kompanio 838 / MT8188G   6nm, Cortex-{A78,A55}, Mali-G57 MC3
    - cros: geralt
  - 2021, Kompanio 900T / MT8791,  6nm, Cortex-{A78,A55}, Mali-G68 MCT
  - 2021, Kompanio 1200 / MT8195,  6nm, Cortex-{A78,A55}, Mali-G57 MC5
    - cros: cherry
    - `mt8195-dojo-rev1-sku1-sku3.dts`
    - `mt8195-tomato-rev3.dts`
  - 2021, Kompanio 1300T / MT8797, 6nm, Cortex-{A78,A55}, Mali-G77 MC9
  - 2022, Kompanio 1380 / MT8195T, 6nm, Cortex-{A78,A55}, Mali-G57 MC5

## MT8195 SoC

- `mediatek/mt8195.dtsi`
- Power
  - Power Controller
    - `mediatek,mt8195-power-controller`
    - why is it a child node of `mediatek,mt8195-scpsys`?
  - PMIC Wrapper
    - `mediatek,mt8195-pwrap`
    - it actually connects to a PMIC over SPI
      - e.g., `mediatek,mt6359`, which is an MFD with
        - `mediatek,mt6359-auxadc`
        - `mediatek,mt6358-rtc`
        - `mediatek,mt6359-keys`
        - `mt6359-regulator`
  - SPMI controller
    - `mediatek,mt8195-spmi`
    - it connects to regulators
      - e.g., `mediatek,mt6315-regulator`
  - Smart Voltage Scaling (SVS)
    - `mediatek,mt8195-svs`
- Clock
  - clock system
    - CLKSQ generates 26MHz
    - PLLs multiples the freq
      - controlled by `mediatek,mt8195-apmixedsys`
    - CKGEN consists of dividers and gates
      - `mediatek,mt8195-topckgen`
  - timers
    - `mediatek,mt8195-timer`
    - Application Processor X General Purpose Timer (APXGPT)
  - watchdog
    - `mediatek,mt8195-wdt`
    - Top Reset Generation Unit (TOPRGU)
- AP
  - mcu system (MCUSYS)
    - cpu cores
      - `arm,cortex-a78` x4
      - `arm,cortex-a55` x4
    - DynamIQ Shared UNIT (DSU)
    - interrupt controller, e.g., CoreLink GIC-{600,700}
      - `arm,gic-v3`
    - dvfs
      - `mediatek,cpufreq-hw`
    - interconnect, e.g., CoreLink CCI-500
  - gpu system (GPUSYS)
    - `mediatek,mt8195-mali`
  - apu system (APUSYS)
    - MVPU (MediaTek Vision Processing Unit)
    - MDLA (MediaTek Deep Learning Accelerator)
- Memory
  - nor controller
    - `mediatek,mt8195-nor`
  - dram controller (DRAMC)
  - external memory interface (EMI)
    - `mediatek,mt8183-emi`
    - EMI takes requests from MCU, GPU, APU, MMSYS, etc.
    - it schedules and dispatches requests to DRAMC
  - mmc & sd controller (MSDC)
    - `mediatek,mt8195-mmc`
- Thermal
  - AUXADC
    - `mediatek,mt8195-auxadc`
    - it is connected to the thermal controller to read temperatures
  - low-voltage thermal sensor (LVTS)
    - `mediatek,mt8195-lvts-ap`
    - `mediatek,mt8195-lvts-mcu`
- Multimedia
  - multimedia pipeline (MMSYS)
  - display pipeline (VDOSYS)
    - `mediatek,mt8195-vdosys0`
    - `mediatek,mt8195-vdosys1`
    - `mediatek,mt8195-disp-ovl`
    - `mediatek,mt8195-disp-rdma`
    - `mediatek,mt8195-disp-color`
    - `mediatek,mt8195-disp-ccorr`
    - `mediatek,mt8195-disp-aal`
    - `mediatek,mt8195-disp-gamma`
    - `mediatek,mt8195-disp-dither`
    - `mediatek,mt8195-disp-dsi`
    - `mediatek,mt8195-disp-dsc`
    - `mediatek,mt8195-disp-merge`
    - `mediatek,mt8195-disp-ethdr`
    - `mediatek,mt8195-dp-intf`
  - video processing pipeline (VPPSYS)
    - `mediatek,mt8195-vppsys0`
    - `mediatek,mt8195-vppsys1`
  - Multimedia Data Path (MDP)
    - `mediatek,mt8195-mdp3-rdma` (read dma)
    - `mediatek,mt8195-mdp3-fg` (film grain)
    - `mediatek,mt8195-mdp3-stitch`
    - `mediatek,mt8195-mdp3-hdr`
    - `mediatek,mt8195-mdp3-aal` (Adaptive Ambient Light)
    - `mediatek,mt8195-mdp3-rsz` (resizer)
    - `mediatek,mt8195-mdp3-tdshp` (two-dimensional sharpness)
    - `mediatek,mt8195-mdp3-color`
    - `mediatek,mt8195-mdp3-ovl` (overlay)
    - `mediatek,mt8195-mdp3-padding`
    - `mediatek,mt8195-mdp3-tcc` (tone curve conversion)
    - `mediatek,mt8195-mdp3-wrot`
  - video codec (VDEC & VENC)
    - `mediatek,mt8195-vcodec-dec`
    - `mediatek,mt8195-vcodec-enc`
  - jpeg codec
    - `mediatek,mt8195-jpgdec`
    - `mediatek,mt8195-jpgenc`
- Audio
  - Audio
    - `mediatek,mt8195-audio`
  - DSP
    - `mediatek,mt8195-dsp`
    - for audio signal processing
- Connectivity
  - UART
    - `mediatek,mt8195-uart`
  - SPI
    - `mediatek,mt8195-spi`
    - they connect to, for example,
      - `google,cros-ec-spi`
      - spi nor
      - fingerprint reader
  - PWM
    - `mediatek,mt8195-disp-pwm`
      - for display backlight
  - Ethernet
    - `mediatek,mt8195-gmac`
  - USB
    - `mediatek,mt8195-mtu3`
    - `mediatek,mt8195-xhci`
  - PCIe
    - `mediatek,mt8195-pcie`
  - I2C/I3C
    - `mediatek,mt8195-i2c`
    - they connect to, for example,
      - `elan,ekth3000`
      - `google,cr50`
      - `hid-over-i2c`
      - `mediatek,mt6360`
      - audio codec
  - GPIO
    - `mediatek,mt8195-pinctrl`
- Misc
  - system companion processor (SCP)
    - `mediatek,mt8195-scp`
    - always-on, designed for sensor hub, wake-on-voice, etc.
  - global command engine (GCE)
    - `mediatek,mt8195-gce`
    - it offloads register writes, used by the display driver, etc.
    - aka, CMDQ mailbox
  - eFuse
    - `mediatek,mt8195-efuse`
- `mt8195-cherry-dojo-r1.dts` sound
  - `mt8195.dtsi` has
    - `afe: mt8195-afe-pcm@10890000` is the i2s controller
    - `adsp: dsp@10803000` is the audio dsp
    - `sound: mt8195-sound` is for the asoc machine driver
  - `mt8195-cherry.dtsi` and `mt8195-cherry-dojo-r1.dts` have
    - `sound`
      - `compatible = "mediatek,mt8195_mt6359_max98390_rt5682";`
      - `hs-playback-dai-link` connects to `audio_codec` for headset
        - over i2s `ETDM1_OUT_BE`
      - `hs-capture-dai-link` connects to `audio_codec` for mic
        - over i2s `ETDM2_IN_BE`
      - `spk-playback-dai-link` connects to `spk_r_amp` and `spk_l_amp` for
        speaker
        - over i2s `ETDM2_OUT_BE`
      - `displayport-dai-link` connects to `dp_tx` of the display
        - over i2s `DPTX_BE`
    - `i2c2`
      - `audio_codec: codec@1a`
        - `compatible = "realtek,rt5682s";`
      - `spk_r_amp: amplifier@38`
        - `compatible = "maxim,max98390";`
      - `spk_l_amp: amplifier@39`
        - `compatible = "maxim,max98390";`

## MT8196 SoC

- <https://chromium-review.googlesource.com/c/chromiumos/third_party/kernel/+/6074027>
- clocksource
  - `systimer: systimer@1c400000` is `mediatek,mt6765-timer`
- firmware
  - `firmware: firmware`
    - `scmi: scmi` is `arm,scmi`
      - it uses a mailbox: `tinysys_mbox`
      - ACMI resembles ACPI, a fw that exposes various interfaces for various
        functions
      - the interfaces are usually standardized
      - but in this case, the fw is tinysys and the interface is specific to tinysys
- gpu
  - `dp_intf0: dp-intf@32430000` and `dp_intf1: dp-intf@32440000` are `mediatek,mt8196-dp-intf`
  - `dsi0: dsi@32490000` is `mediatek,mt8196-dsi`
  - `disp_dvo0: disp-dvo0@324c0000` is `mediatek,mt8196-edp-dvo`
  - `dp_tx: dp-tx@3ec00000` is `mediatek,mt8196-dp-tx`
  - `edp_tx: edp-tx@3ec40000` is `mediatek,mt8196-edp-tx`
    - on rauru, `panel: panel` is `edp-panel`
      - on navi, it is `samsung,atna33xc20`
        - it has backlight control and does not use `disp_pwm0`
  - `gpu: gpu@48000000` is `arm,mali-valhall-csf`
  - `gpufreq: gpufreq@48500000` is `mediatek,gpufreq`
  - `gpupdma: gpupdma@48540000` is `mediatek,gpupdma`
  - `gpueb: gpueb@4b000000` is `mediatek,gpueb`
  - `ghpm: ghpm@4b800000` is `mediatek,ghpm`
  - on rauru/navi,
    - `disp_dvo0` -> `edp_tx` -> `panel`
    - `dsi0` -> `anx_bridge` -> `usb_c0`
    - `dp_intf0`/`dp_intf1` -> `dp_tx` -> `sound`
- i2c
  - `i2c0: i2c@13130000` to `i2c14: i2c@162c0000` are `mediatek,mt8188-i2c`
  - on rauru
    - `i2c0`: `trackpad_elan: trackpad@15` is `elan,ekth3000`
      - on navi: `trackpad@2c` and `trackpad@38` are `hid-over-i2c`
    - `i2c1`: `tpm@50` is `google,cr50`
    - `i2c2`: `touchscreen: touchscreen@41` is `ilitek,ili2901`
      - on navi: `touchscreen@14` is `goodix,gt7375p`
        - on navi sku1, it is disabled
    - `i2c3`: `nau8825: audio-codec@1a` is `nuvoton,nau8825`
      - on navi:
        - `quad_tas2563: audio-codec@4d` is `ti,tas2563`
        - `rt5682s: audio-codec@1a` is `realtek,rt5682s`
    - `i2c4`: sar
      - on navi: `anx_bridge: anx7625@58` is `analogix,anx7625`
        - it converts mipi/dsi to dp
    - `i2c5`: ec hid keyboard
    - `i2c6`: eusb
- iommu
  - `mm_smmu: iommu@30800000`, `gpu_smmu: iommu@48600000`, and `apu_smmu: iommu@4c000000` are `arm,smmu-v3`
- irqchip
  - `gic: interrupt-controller@c400000` is `arm,gic-v3`
- mailbox
  - `adsp_mailbox0: mailbox@1a350000` and `adsp_mailbox1: mailbox@1a360000` are `mediatek,mt8186-adsp-mbox`
  - `tinysys_mbox: mailbox@1c351000` is `mediatek,tinysys_mbox`
  - `gce0: gce@300c0000` and `gce1: gce@30140000` are `mediatek,mt8196-gce`
    - Global Command Engine, used to read/write display-related regs
    - th drive exposes the mbox as cmdq interface
  - `apu_mailbox: mailbox@4c200000` is `mediatek,mt8196-apu-mailbox`
- media
  - `video_codec: video@36000000` is `mediatek,mt8196-vcodec-dec`
  - `venc: video-codec@38020000` is `mediatek,mt8196-vcodec-enc`
  - `jpeg-decoder` is `mediatek,mt8196-jpgdec`
  - `jpeg-encoder` is `mediatek,mt8196-jpgenc`
- memory
  - `memory-controller@10236000 ` is `mediatek,mt8196-dramc`
    - dram controller
  - `nsmpu: nsmpu@1046f00`, `ssmpu: ssmpu@1056f000`, and more are `mediatek,smpu`
    - smpu controller
  - `smi_disp_common: smi-comm@30020000`, `smi_mdp_common: smi-comm@30021000`, and more are `mediatek,mt8196-smi-common`
    - Smart Multimedia Interface
    - enable/disable iommu, and control pm/clk for local arbiter
  - `smi_larb0: larb@32a60000` to `smi_larb47: larb@38c90000` are `mediatek,mt8196-smi-larb`
  - `smi_disp_venc_sub_comm0: smi-sub-comm@38070000`, `smi_mdp_venc_sub_comm1: smi-sub-comm@38870000` and more are `mediatek,mt8196-smi-sub-common`
- misc
  - `slbc: slbc@117800` is `mediatek,mt8196-slbc`
    - System Level Buffer and Cache
  - `cm_mgr: cm-mgr@c100000` is `mediatek,mt8196-cm-mgr`
    - manager for dram opp
  - `sram@1c350000` and `sram@1c360000` are `mmio-sram`
    - `scmi_tx_shmem: mailbox-sram@0` and `scmi_rx_shmem: mailbox-sram@0` are
      `arm,scmi-shmem`
- mmc
  - `mmc1: mmc@16310000` and `mmc2: mmc@16320000` are `mediatek,mt8196-mmc`
- nvmem
  - `efuse: efuse@13260000` is `mediatek,efuse`
    - for soc info
- pci
  - `pcie0: pcie@16910000` to `pcie2: pcie@16970000` are `mediatek,mt8196-pcie`
    - `pcie0` connects to `pciephy0`
    - `pcie1` connects to `pciephy1`
    - `pcie2` connects to `pciephy2`
  - on rauru, only `pcie0` is enabled
    - it has a MT7925E wireless card
- phy
  - `mipi_tx_config0: mipi-tx-config@130b0000` is `mt8196-mipi-tx`
  - `u2phy0: usb-phy0@16730000`, `u2phy1: usb-phy1@16740000`, and `u3phy0: usb3-phy0@16773000` are `mediatek,xsphy`
  - `pciephy0: phy@16900000` to `pciephy2: phy@16960000` are `mediatek,mt8196-pcie-phy`
- pinctrl
  - `pio: pinctrl@1002d000` is `mediatek,mt8196-pinctrl`
- pmdomain
  - `scpsys: power-controller@1c004000` is `mediatek,mt8196-scpsys-hwv`
    - it seems SPM-related, System Power Manager?
  - `hfrpsys: power-controller@31b50000` is `mediatek,mt8196-hfrpsys-hwv`
    - it seems MMPC-related
- pwm
  - `disp_pwm0: disp-pwm0@160b0000` and `disp_pwm1: disp-pwm1@160c0000` are `mediatek,mt8183-disp-pwm`
    - pwm for backlight
  - `pwm: pwm@16330000` is `mediatek,pwm`
    - unused
- remoteproc
  - `mcupm: mcupm@c240000` is `mediatek,mt8196-mcupm`
    - mcusys (cpu) power management
    - it is powered on before kernel
  - `apusys_rv: remoteproc@19001000` is `mediatek,mt8196-apusys_rv`
    - apusys (npu) coprocessor
    - it runs `apusys.img` with a mailbox: `apu_mailbox`
  - `vcp: vcp@31800000` is `mediatek,vcp`
    - video codec coprocessor
    - it runs `vcp.img`
- soc
  - `devapc_apinfra_dramc: devapc@102f3000`, `devapc_apinfra_emi: devapc@10613000`, and more are `mediatek,mt8196-devapc`
    - it prevents slaves from being accessed by unexpected masters, as a part
      of trustzone
  - `dvfsrc: dvfsrc@1c013000` is `mediatek,mt8196-dvfsrc`
    - Dynamic Voltage and Frequency Scaling Resource Collector
    - it monitors loads of various blocks and remoteprocs, and pick the
      minimum operating voltage and dram freq to save power
  - `apusys-apummu` is `mediatek,rv-apummu-mt8196`
  - `mtk_apu_mem_code: mtk-apu-mem-code` is `mediatek, apu_mem_code`
  - `mtk_apu_mem_data: mtk-apu-mem-data` is `mediatek, apu_mem_data`
  - `mvpu` is `mediatek, mt8196-mvpu`
    - MediaTek Vision Processing Unit, part of apusys
  - `vdisp-ctrl` is `mediatek,mt8196-vdisp-ctrl`
    - adjust voltage for display controller dynamically
  - `vmm: vmm` is `mediatek,mt8196-vmm`
    - adjust voltage for vcp dynamically
- sound
  - `adsp: adsp@1a000000` is `mediatek,mt8196-dsp`
    - it runs sof fw with 2 mailboxes: `adsp_mailbox0` and `adsp_mailbox1`
  - `afe: mt8196-afe-pcm@1a110000` is `mediatek,mt8196-sound`
    - this is the sound controller, bound by asoc platform driver
  - `sound: sound` is `mediatek,mt8196-mt6681-sound`
    - this is  bound by asoc machine driver
    - on navi, it is `mt8196-rt5682s-sound` instead
- spi
  - `spi0: spi@16110000` to `spi7: spi@161f0000` are `mediatek,mt8196-spi`
    - on rauru,
      - `spi1`: `cros_ec: ec@0` is `google,cros-ec-spi`
        - `i2c_tunnel: i2c-tunnel` is `google,cros-ec-i2c-tunnel`
          - `battery: sbs-battery@b` is `sbs,sbs-battery`
        - `keyboard_controller: keyboard-controller` is `google,cros-ec-keyb`
        - `typec` is `google,cros-ec-typec`
          - `usb_c0: connector@0` and `usb_c1: connector@1` are `usb-c-connector`
        - on navi, `keyboard-backlight` is `google,cros-kbd-led-backlight`
      - `spi5`: `cros_ec_fp: ec@0` is `google,cros-ec-spi`
        - on navi, it is disabled
  - `nor_flash: spi@16340000` is `mediatek,mt8186-nor`
    - spi controller for nor flash
    - on rauru, the flash is `jedec,spi-nor`
- spmi
  - `spmi: spmi@1c01a000` is `mediatek,mt8196-spmi`
    - on rauru,
      - `main_pmic: pmic@4` is `mediatek,mt6363`
      - `second_pmic@5` is `mediatek,mt6373`
      - `mt6685_mfd: mt6685_mfd` is `mediatek,mt6685`
        - rtc
      - `mt6316_6: mt6316@6` to `mt6316_8: mt6316@8` and `mt6316_15: mt6316@15` are `mediatek,mt6316`
        - mfd with regulators
- thermal
  - `therm_intf: therm-intf@114000` is `mediatek,therm_intf`
  - `lvts: thermal-sensor@14414000` is `mediatek,mt8196-lvts`
    - it defines ~30 thermal zones: `soc_max`, `cpu-N-thermal`, `gpuN-thermal`, etc.
- tty
  - `uart0: serial@16000000` to `uart2: serial@16020000` are `mediatek,mt6577-uart`
  - `uart3: serial@16030000` are `mediatek,mt6985-uart`
  - on rauru, only `uart0` and `uart1` are enabled
- ufs
  - `ufshci: ufshci@16810000` is `mediatek,mt8183-ufshci`
- usb
  - `xhci0: usb@16700000` and `xhci1: usb1@16710000` are `mediatek,mtk-xhci`
    - `xhci0` connects to two phys: `u2phy0` for usb 2.0 and `u3phy0` for usb 3.0
      - on rauru,  usb 2.0 has a bluetooth dongle
    - `xhci1` connects to one phy: `u2phy1` for usb 2.0
      - on rauru, it has a usb camera
- watchdog
  - `watchdog: watchdog@1c010000` is `mediatek,mt6589-wdt`

## MT8196 Drivers

- e.g., `uart0: serial@16000000`
  - it inherits `interrupt-parent = <&gic>` from its grandparent
  - it has two clks: `clk26m` and `pericfg_ao_clk`
  - `CONFIG_ARM_GIC_V3` drives `gic`
  - `CONFIG_COMMON_CLK` drives `clk26m`
  - `CONFIG_COMMON_CLK_MT8196` drives `pericfg_ao_clk`, `cksys_clk`,
    `vlp_cksys_clk` and more
    - it calls `syscon_regmap_lookup_by_phandle("hw-voter-regmap")` and returns
      the regmap defined by `hwv` node
  - `CONFIG_SERIAL_8250_MT6577` drives `uart0`
- e.g., `ufshci: ufshci@16810000`
  - it has 9 irqs from `gic`
  - it has 14 clocks from `cksys_clk` and `ufscfg_ao_clk`
  - it has 3 regulators: `dvfsrc_vcore`, `mt6363_vemc`, `mt6363_vufs12`
  - it has 3 resets from `ufscfgao_rst`
  - `CONFIG_COMMON_CLK_MT8196_UFSSYS` drives `ufscfg_ao_clk`
  - `CONFIG_MTK_DVFSRC` drives `dvfsrc` and `CONFIG_REGULATOR_MTK_DVFSRC`
    drives `dvfsrc_vcore`
  - `CONFIG_RESET_TI_SYSCON` drives `ufscfgao_rst`
  - `CONFIG_SPMI_MTK_PMIF` drives `spmi`, `CONFIG_MFD_MTK_SPMI_PMIC` drives
    `main_pmic`, and `CONFIG_REGULATOR_MT6363` drives `mt6363_*`
    - also `spmi` depends on `pio`
  - `CONFIG_PINCTRL_MT8196` drives `pio`
- e.g., `xhci0: usb@16700000`
  - it has 2 irqs from `gic` and `pio`
  - it has 2 phys: `u2port0` for 2.0 and `u3port0` for 3.0
  - it has 3 clocks from `vlp_cksys_clk` and `cksys_clk`
  - it has a pmdomain: `scpsys`
  - `CONFIG_ARM_GIC_V3` drives `gic`
  - `CONFIG_PINCTRL_MT8196` drives `pio`
  - `CONFIG_PHY_MTK_XSPHY` drives `u2port0` and `u3port0`
  - `CONFIG_COMMON_CLK_MT8196` drives the clocks
  - `CONFIG_MTK_SCPSYS` drives `scpsys`
- base drivers
  - `CONFIG_ARM_GIC_V3` for irqchip
  - `CONFIG_COMMON_CLK_MT8196*` for various clks
    - `CONFIG_RESET_TI_SYSCON` for reset controllers (for UFS, PCIe)
  - `CONFIG_SPMI_MTK_PMIF` for spmi bus
    - `CONFIG_MFD_MTK_SPMI_PMIC` for various PMICs
      - `CONFIG_REGULATOR_MT6316` for MT6316 regulator (for CPU cores)
      - `CONFIG_REGULATOR_MT6363` for MT6363 regulator (for SOC, UFS, memory)
      - `CONFIG_REGULATOR_MT6373` for MT6373 regulator (for panel, touch, trackpad, sd card)
  - `CONFIG_MTK_SCPSYS` for pmdomain (for usb, pcie, audio, vcp, dp)
  - `CONFIG_PINCTRL_MT8196` for pinctrl (for audio, usb 5v, dp, pcie, i2c, mmc, nor, spi)
  - `CONFIG_MTK_MBOX` for low-level hw mbox to communicate with some
    coprocessors (gpueb, mcupm)
    - `CONFIG_RPMSG_MTK` for rpmsg iface
      - `CONFIG_MTK_IPI` for high-level ipi iface
- misc drivers
  - `CONFIG_MTK_DVFSRC` for DVFSRC
    - `CONFIG_REGULATOR_MTK_DVFSRC` for DVFSRC regulator (for UFS)
  - `CONFIG_MEDIATEK_SPMI_PMIC_ADC` for MT6363/MT6373 ADC
  - `CONFIG_MFD_MT6685` for MT6685 PMIC
    - `CONFIG_RTC_DRV_MT6685` for MT6685 RTC
  - `CONFIG_SERIAL_8250_MT6577` for MT6577 UART
  - `CONFIG_MTK_TINYSYS_MBOX` for tinysys mailbox (as a transport for SCMI)
    - `CONFIG_MTK_TINYSYS_SCMI` for tinysys protocol (as an extension for SCMI)
      - `CONFIG_MTK_CM_MGR_MT8196` for memory tuning?
      - `CONFIG_MTK_SLBC_MT8196` for memory tuning?
  - `CONFIG_MTK_TINYSYS_MCUPM_SUPPORT` for MCUPM
    - MCUPM is a coprocessor that is started by bootloader to manage MCUSYS
      (cpu) power
    - this driver is for querying stats?
- display and media drivers
  - `CONFIG_MTK_VDISP` for (smart) display regulator
  - `CONFIG_MTK_VMM` for (smart) media regulator
  - `CONFIG_ARM_SMMU_V3_MEDIATEK` for iommu (for display, vcp)
  - `CONFIG_MTK_CMDQ_MBOX` for GCE
  - tbd
- gpu drivers
  - tbd

## MT8196 GPUEB

- <https://chromium-review.googlesource.com/c/chromiumos/third_party/kernel/+/6074027>
- `CONFIG_MTK_MBOX` provides `mtk_mbox_device` to talk to tinsys mbox directly
  - a client fills out `mtk_mbox_device` and calls `mtk_mbox_probe`
    - this ioremaps resources and requests irq
  - `mtk_mbox_write` sends data to the mbox using mmio
  - `mtk_mbox_trigger_irq` notifies the mbox about the data
  - on irq, `mtk_mbox_isr` calls the client-provided callbacks
  - `mtk_mbox_read` receives data from the mbox using mmio
- `CONFIG_RPMSG_MTK` provides `rpmsg_device` on top of `mtk_mbox_device`
  - a client calls `mtk_rpmsg_create_mbox_device` to wrap an `mtk_mbox_device`
  - `mtk_rpmsg_create_channel` creates a `mtk_rpmsg_channel_info_mbox`, the
    private data for use with `rpmsg_create_ept`
  - `rpmsg_create_ept` calls `mtk_rpmsg_create_ept` to create a
    `rpmsg_endpoint`
    - the rx cb is unused
  - `rpmsg_send` calls `mtk_rpmsg_send` to send data to the mbox
    - `mtk_mbox_write` writes data to the mbox
    - `mtk_mbox_trigger_irq` notifies the mbox
  - there is no proper `rpmsg_driver`
- `CONFIG_MTK_IPI` provides `mtk_ipi_device` on top of `mtk_mbox_device`
  - a client calls `mtk_ipi_device_register` to wrap an `mtk_mbox_device`
    - `mtk_rpmsg_create_mbox_device` wraps the `mtk_mbox_device`
    - `rpmsg_create_ept` creates an endpoint for each channel
    - that is, it uses `CONFIG_RPMSG_MTK` internally
  - `mtk_ipi_register` updates the rx cb and buf for a channel
  - `mtk_ipi_send` sends data to a channel
    - `rpmsg_trysend` seneds data to the corresonding `rpmsg_endpoint`
  - on irq, `mtk_mbox_isr` calls `ipi_isr_cb`
  - `mtk_ipi_recv` calls the rx cb registered with `mtk_ipi_register`
    - `mtk_mbox_polling` or `mtk_mbox_read` should have been called to receive
      the data to `pin_r->pin_buf`
- `__gpueb_pdrv_probe` probes `mediatek,gpueb`
  - some global variables are initialized
    - `g_gpueb_gpr_base` is `gpueb_gpr_base`
    - `g_gpueb_cfgreg_base` is `gpueb_cfgreg_base`
    - `g_mfg0_pwr_con` is `mfg0_pwr_con`
  - `gpueb_ipi_init` inits `gpueb_mboxdev` and `gpueb_ipidev`
    - `gpueb_ipi_table_init` fills out `gpueb_mboxdev`
      - `name` is `GPUEB_MBOXDEV_NAME` (`gpueb_mboxdev`)
      - `count` is `mbox-count` (1)
      - `g_mbox_size` is `mbox-size` (160)
      - `g_slot_size` is `slot-size` (4)
      - `g_ts_mbox` is `ts-mbox` (0)
      - `send_count` is len(`send-table`) / 3 (36 / 3 = 12)
      - `recv_count` is len(`recv-table`) / 5 (60 / 5 = 12)
      - `gpueb_mbox_pin_send_name` is `send-name-table`
        - `IPI_ID_FAST_DVFS_EVENT`, ged eb
        - `IPI_ID_GPUFREQ`, gpufreq
          - `CMD_POWER_CONTROL`
          - etc
        - `IPI_ID_SLEEP`, ghpm
          - `GPUEB_SLEEP_IPI_MAGIC_NUMBER` before powering off ghpm
        - `IPI_ID_TIMER`, gpueb timesync
        - `IPI_ID_FHCTL`, no user
        - `IPI_ID_CCF`, gpueb hwvoter
        - `IPI_ID_GPUMPU`, gpueb gpumpu (unused)
        - `IPI_ID_FAST_DVFS`, ged eb
          - `GPUFDVFS_IPI_SET_NEW_FREQ`
          - `GPUFDVFS_IPI_PMU_START`
          - `GPUFDVFS_IPI_SET_POWER_STATE`
          - etc
        - `CH_IPIR_C_MET`
        - `CH_IPIS_C_MET`
        - `IPI_ID_BRISKET`, no user
        - `IPI_ID_PPB`, no user
      - `gpueb_mbox_pin_recv_name` is `recv-name-table`
      - `info_table` is a `mtk_mbox_info`
        - `id` is 0
        - `slot` is `g_mbox_size`
        - `enable` is 1
        - `is64d` is 0
        - `opt` is `MBOX_OPT_SMEM`
      - `pin_send_table` and `gpueb_mbox_pin_send` are 12 `mtk_mbox_pin_send`
        - `chan_id` and `pin_index` are 0..11
        - `mbox` is 0
        - `msg_size` is variable
          - they sum to 56
      - `pin_recv_table` and `gpueb_mbox_pin_recv` are 12 `mtk_mbox_pin_recv`
        - `chan_id` and `pin_index` are 0..11
        - `mbox` is 0
        - `msg_size` is variable
          - they sum to 36
        - `recv_opt` is 0 (receive) or 1 (response)
        - `cb_ctx_opt` is 0 (isr context) or 1 (process context)
    - `gpueb_ipidev` is filled out
      - `name` is `gpueb_ipidev`
      - `id` is `IPI_DEV_GPUEB`
      - `mbdev` is `gpueb_mboxdev`
      - `timeout_handler` is `gpueb_plat_ipi_timeout_cb`
    - `mtk_mbox_probe` inits `gpueb_mboxdev`
      - this initializes `info_table` and requests resources and irq
      - `base` is `mbox0_base` (0x4b09fd80)
      - `slot` is 160
      - `init_base_reg` is `mbox0_init` (0x4b170008)
      - `set_irq_reg` is `mbox0_set` (0x4b170004)
      - `clr_irq_reg` is `mbox0_clr` (0x4b170074)
      - `send_status_reg` is `mbox0_send` (0x4b170000)
      - `recv_status_reg` is `mbox0_recv` (0x4b170078)
      - `irq_num` is `mbox0` (608)
      - `mtk_mbox_isr` is the irq handler
    - `mtk_ipi_device_register` inits `gpueb_ipidev`
      - `mtk_rpmsg_create_mbox_device` creates an rpmsg dev
      - `mtk_rpmsg_create_channel` creates `send_count` channels
      - `rpmsg_create_ept` creates `send_count` epts  without rx cb
      - `ipi_cb` is `ipi_isr_cb`
    - `g_gpueb_mbox_ipi` is `mbox0_send`
  - `gpueb_reserved_mem_init`
    - `gpueb_mem_base_phys` and `gpueb_mem_size` are `mediatek,gpueb-resv-mem`
      - 0xa0000000 and 2MB
    - `gpueb_mem_num` is len(`gpueb-mem-table`) (2)
    - `gpueb_reserve_mblock_ary_name` is `gpueb-mem-name-table`
      (`MEM_ID_GPUFREQ` and `MEM_ID_LOG`)
    - `gpueb_reserve_mblock_ary` is `gpueb-mem-table`
    - `gpueb_mem_base_virt` is `ioremap_wc`
  - `gpueb_logger_support` is `gpueb-logger-support` (0)
  - `gpueb_debug_init` creates `/proc/gpueb`
  - `gpueb_timesync_init`
    - `g_gpueb_ts_mbox` is 0
    - `g_gpueb_ts_mbox_offset_base` is `IPI_ID_TIMER` (15)
    - `create_workqueue` creates wq `gpueb_ts_wq` with work `timesync_ws`
    - more
  - `gpueb_hw_voter_dbg_init`
    - `mtk_ipi_register` registers channel `IPI_ID_CCF` (5)
    - `gpueb_hw_voter_create_procfs` creates `/proc/gpueb_hw_voter`
  - `ghpm_wrapper_init`
    - `g_ghpm_support` is `ghpm-support` (1)
- `__ghpm_pdrv_probe` probes `mediatek,ghpm`
  - some global variables are initialized
    - `g_mfg_rpc_base` is `mfg_rpc`
    - `g_spm_mfg0_pwr_con` is `spm_mfg0_pwr_con`
    - `g_clk_cfg_6` is `clk_cfg_6`
    - `g_clk_cfg_6_set` is `clk_cfg_6_set`
    - `g_clk_cfg_6_clr` is `clk_cfg_6_clr`
    - `mfg_mt8196_e2_id_con` is `mfg_mt8196_e2_id_con`
    - `g_gpueb_lp_state_gpr` is `GPUEB_SRAM_GPR10`
    - `g_ipi_channel` is `IPI_ID_SLEEP` (2)
    - `g_gpueb_slot_size` is 4
    - `ghpm_fp` is `platform_ghpm_fp`
    - `g_ghpm_ready` is 1
  - `mtk_ipi_register` registers `g_ipi_channel`
- `gpufreq_wrapper_pdrv_probe` probes `mediatek,gpufreq_wrapper`
  - some global variables are initialized
    - `g_dual_buck` is `dual-buck` (1)
    - `g_gpueb_support` is `gpueb-support` (1)
    - `g_gpufreq_bringup` is `gpufreq-bringup` (0)
  - `gpufreq_shared_memory_init`
    - `gpueb_mem_pa` and `gpueb_mem_size` are `mediatek,gpueb-resv-mem`
    - `g_shared_status` points to the first dw
    - `g_shared_mem_pa` points to the begining
    - `g_shared_mem_size` is 16KB
  - `gpufreq_gpueb_init`
    - `g_ipi_channel` is `IPI_ID_GPUFREQ`
    - `mtk_ipi_register`
    - `gpueb_gpr_addr` is `GPUEB_SRAM_GPR13`
    - `g_ipi_magic` is from `GPUEB_SRAM_GPR13`
    - `gpufreq_ipi_to_gpueb` sends `CMD_INIT_SHARED_MEM`
    - `mtk_ipi_send_compl_to_gpueb`
      - `rpmsg_trysend` calls `mtk_mbox_send`
        - it copies msg to shm and triggers mbox irq
      - `mtk_mbox_polling`
  - `g_gpufreq_ready`
- `ged_pdrv_probe` probes `mediatek,ged`
  - `ged_gpufreq_init`
- when mali calls `pm_callback_power_on` to power on the device
  - `ghpm_ctrl` calls `__ghpm_ctrl`
    - write `CLK_CKFG_6_CLR` to turn on `CLK_MFG_EB`
    - poll `MFG_GHPM_RO0_CON` for `GHPM_STATE` and `GHPM_PWR_STATE`
    - play with `MFG_GHPM_CFG0_CON` to turn on GHPM
  - `wait_gpueb` calls `__wait_gpueb`
    - it polls these registers
      - `MFG_GHPM_RO0_CON`
      - `mfg0_pwr_sta()`
      - `g_gpueb_lp_state_gpr`
  - `pm_callback_power_on_nolock`
    - `gpufreq_power_control` sends `CMD_POWER_CONTROL` to gpueb
  - `mtk_notify_gpu_power_change`
