Kernel Config
=============

## Flow

- config
  - `make alldefconfig` to generate config
    - or `make defconfig` to use arch defaults, which include common device
      drivers for the arch
    - or download a pre-made config and `make olddefconfig`
      - such as
        <https://raw.githubusercontent.com/raspberrypi/linux/rpi-5.10.y/arch/arm64/configs/bcm2711_defconfig>
  - `make menuconfig` to edit generated config
    - to discover non-discoverable devices,
      - `dtc -I fs /sys/firmware/devicetree/base` and look for `compatible`
        property.  Kernel uses the property to bind drivers.
      - `find /sys/devices/LNXSYSTM:00 -name modalias`.  Kernel uses modalias
        to bind drivers.  (It is constructed from `_HID` and `_CID` of the
        ACPI devices btw)
    - to discover discoverable devices,
      - lspci
      - lsusb
- build
  - `make` to build kernel image, modules, and dtbs
- install
  - `make install` to invoke `installkernel`
  - `make modules_install` to install to `INSTALL_MOD_PATH`
- cross compile
  - get cross compiler
    - `crossbuild-essential-arm64` on Debian-like
    - `aarch64-linux-gnu-gcc` on Arch-like
  - set variables
    - `ARCH=arm64`
    - `CROSS_COMPILE=aarch64-linux-gnu-`
  - manual install
    - copy `arch/arm64/boot/Image` for ARM64
- post install (Arch)
  - initramfs
    - `mkinitcpio -k $version -g /boot/initramfs.img`
  - systemd-boot
    - `/boot/loader/entries/custom.conf`
      - `title Custom Linux`
      - `linux /vmlinuz`
      - `initrd /initramfs.img`
      - `options root=/dev/sda2 rw`
  - out-of-tree drivers
    - `pacman -S broadcom-wl-dkms`
    - `dkms autoinstall`
- post install (Raspberry Pi)
  - copy `arch/arm64/boot/Image` and
    `arch/arm64/boot/dts/broadcom/bcm2711-rpi-4-b.dtb`
  - `config.txt`
    - `arm_64bit=1`
    - `kernel=Image`

## Tips

- Unable to boot?
  - must built-in for initramfs to work
    - script (#!) support for init scripts
    - devtmpfs and unix socket support for udev
  - to debug
    - Built-in EFI or Simple framebuffer to see console
    - Built-in keyboard driver to interact
    - Built-in scsi/ata/fs drivers to mount
- No `/dev/dri`?
  - `echo 0x1ff > /sys/module/drm/parameters/debug`
  - `[drm:vc5_hdmi_init_resources [vc4]] ERROR Failed to get HDMI state machine clock`
    - make sure `vc4` is loaded after `raspberrypi-clk`
  - `[drm:vc4_hdmi_bind [vc4]] Failed to get ddc i2c adapter by node`
    - make sure `vc4` is loaded after `i2c-brcmstb`

## Config: Common

- select `General setup`
  - deselect `Automatically append version information to the version string`
  - select `System V IPC`
  - select `POSIX Message Queues`, depending on `NET`
  - select `Timers subsystem`
    - select `Timer tick handling (Idle dynticks system (tickless idle))`
    - select `High Resolution Timer Support`
  - select `BPF subsystem`
    - select `Enable bpf() system call`
    - select `Enable BPF Just In Time compiler`, depending on `MODULES`
      - select `Permanently enable BPF JIT and remove BPF interpreter`
  - select `Preemption Model (Voluntary Kernel Preemption (Desktop))`
  - select `Kernel .config support`
    - select `Enable access to .config through /proc/config.gz`
  - select `Control Group support`
  - select `Namespaces support`
    - select `User namespace`
  - select `Automatic process group scheduling`
  - select `Initial RAM filesystem and RAM disk (initramfs/initrd) support`
  - select `Kernel Performance Events And Counters`
    - select `Kernel performance events and counters`
- select `Virtualization`
  - select `Kernel-based Virtual Machine (KVM) support` if desired
- select `Enable loadable module support`
  - select `Module unloading`
- select `Executable file formats`
  - select `Kernel support for MISC binaries`
- select `Memory Management options`
  - select `Transparent Hugepage Support`
    - select `Transparent Hugepage Support sysfs defaults (madvice)`
  - select `Multi-Gen LRU`
    - select `Enable by default`
- select `Networking support`
  - select `Networking options`
    - select `Packet socket`
    - select `Unix domain sockets`
    - select `TCP/IP networking`
    - select `Network packet filtering framework (Netfilter)` if desired
      - select `Core Netfilter Configuration`
        - select `Netfilter connection tracking support`
        - select `Network Address Translation support`
        - select `Netfilter nf_tables support`
        - select `Netfilter nf_tables masquerade support`
        - select `Netfilter nf_tables nat module`, depending on `NF_TABLES_IPV4`
      - select `IP: Netfilter Configuration`
        - select `IPv4 nf_tables support`
    - select `802.1d Ethernet Bridging`
    - select `Virtual Socket protocol` if kvm or guest
    - select `virtio transport for Virtual Sockets` if guest, depending on `PCI` and `VIRTIO_PCI`
  - select `Bluetooth subsystem support` if desired
  - select `Wireless`
    - select `cfg80211 - wireless configuration API`
    - select `Generic IEEE 802.11 Networking Stack (mac80211)`
  - select `RF switch subsystem support`
- select `File systems`
  - select `The Extended 4 (ext4) filesystem`
    - select `Ext4 POSIX Access Control Lists`
  - select `Btrfs filesystem support` if desired
    - select `Btrfs POSIX Access Control Lists`
  - select `F2FS filesystem support` if desired
  - deselect `Dnotify support`
  - select `Filesystem wide access notification`
  - select `Kernel automounter support (supports v3, v4 and v5)` (for systemd)
  - select `FUSE (Filesystem in Userspace) support` if desired
  - select `Overlay filesystem support` if desired
  - select `DOS/FAT/NT Filesystems`
    - select `VFAT (Windows-95) fs support` if uefi
    - select `Enable FAT UTF-8 option by default`
    - select `exFAT filesystem support` if desired
  - select `Pseudo filesystems`
    - select `Tmpfs virtual memory file system support (former shm fs)`
      - select `Tmpfs POSIX Access Control Lists`
    - select `EFI Variable filesystem` if uefi, depending on `EFI`
  - select `Miscellaneous filesystems`
    - select `Persistent store support`
      - select `Log kernel console messages`
      - select `Log panic/oops to a RAM buffer`
  - select `Native language support`
    - select `Codepage 437 (United States, Canada)`
    - select `NLS ISO 8859-1  (Latin 1; Western European Languages)`
    - select `NLS UTF-8`
- select `Cryptographic API`
  - select `Block ciphers` (for iwd)
    - select `AES (Advanced Encryption Standard)`
    - select `DES and Triple DES EDE`
  - select `Length-preserving ciphers and modes` (for iwd)
    - select `CBC (Cipher Block Chaining)`
    - select `ECB (Electronic Codebook)`
  - select `Hashes, digests, and MACs` (for iwd)
    - select `CMAC (Cipher-based MAC)`
    - select `HMAC (Keyed-Hash MAC)`
    - select `MD5`
    - select `SHA-1`
    - select `SHA-224 and SHA-256`
    - select `SHA-384 and SHA-512`
  - select `Compression` (for zram)
    - select `LZO`
  - select `Userspace interface` (for iwd)
    - select `Hash algorithms`
    - select `Symmetric key cipher algorithms`
    - deselect `Obsolete cryptographic algorithms`
- select `Kernel hacking`
  - select `printk and dmesg options`
    - select `Show timing information on printks`
  - select `Kernel debugging`
  - select `Generic Kernel Debugging Instruments`
    - select `Magic SysRq key`
    - select `Debug Filesystem`
  - select `Tracers`
    - select `Kernel Function Tracer`
    - select `Trace syscalls`

## Config: x86

- select `Processor type and features`
  - select `Symmetric multi-processing support`
  - select `Support x2apic` if guest, depending on `HYPERVISOR_GUEST`
  - deselect `Enable MPS table`
  - deselect `Support for extended (non-PC) x86 platforms`
  - select `Intel Low Power Subsystem Support` if intel, depending on `PCI`
  - select `AMD ACPI2Platform devices support` if amd
  - select `Linux guest support` if guest
    - select `Enable paravirtualization code`
  - select `Processor family (Core 2/newer Xeon)` if intel
  - select `Processor family (Opteron/Athlon64/Hammer/K8)` if amd
  - select `CPU microcode loading support`
    - select `AMD microcode loading support` if amd
  - select `EFI runtime service support` if uefi
    - select `EFI stub support`
  - select `Timer frequency (1000 HZ)`
- select `Power management and ACPI options`
  - select `ACPI (Advanced Configuration and Power Interface) Support`
    - select `ACPI Time and Alarm (TAD) Device Support`
    - select `Processor Aggregator`
  - select `CPU Frequency scaling`
    - select `CPU Frequency scaling`
      - select `AMD Processor P-State driver` if amd
      - select `ACPI Processor P-States driver` if amd
  - select `Cpuidle Driver for Intel Processors` if intel
- select `Binary Emulations`
  - select `IA32 Emulation`
- select `Virtualization`
  - select `Kernel-based Virtual Machine (KVM) support` if desired
    - select `KVM for Intel processors support` if intel
    - select `KVM for AMD processors support` if amd
- select `General architecture-dependent options`
  - select `Provide system calls for 32-bit time_t`

## Config: arm64

- select `Platform selection` if arm
  - select `Broadcom SoC Support` if rpi
    - select `Broadcom BCM2835 family`
  - select `Qualcomm Platforms` if msm
- select `Kernel Features`
  - select `Multi-core scheduler support`
  - select `Timer frequency (1000 HZ)`
  - select `Kernel support for 32-bit EL0`
    - select `Emulate deprecated/obsolete ARMv8 instructions`
      - select all
  - select `ARMv8.2 architectural features`
    - select `Enable support for persistent memory`
  - select `Support for NMI-like interrupts`
- select `Boot options`
  - deselect `UEFI runtime support`
- select `Power management options`
  - select `Energy Model for devices with DVFS (CPUs, GPUs, etc)`, depending on `CPU_FREQ`
- select `CPU Power Management`
  - select `CPU Idle`
    - select `CPU idle PM support`
      - select `ARM CPU Idle Drivers`
        - select `PSCI CPU idle Driver`
  - select `CPU Frequency scaling`
    - select `CPU Frequency scaling`
      - select `Generic DT based cpufreq driver`
      - select `Raspberry Pi cpufreq support` if rpi, depending on `MAILBOX`, `BCM2835_MBOX`, `RASPBERRYPI_FIRMWARE` and `CLK_RASPBERRYPI`
      - select `QCOM CPUFreq HW driver` if msm

## Config: Device Drivers

- select `Networking support`
  - select `Networking options` if msm
    - select `Qualcomm IPC Router support`
      - select `SMD IPC Router channels`, depending on `HWSPINLOCK`, `MAILBOX`, `QCOM_SMEM`, and `RPMSG_QCOM_GLINK_SMEM`
      - select `TUN device for Qualcomm IPC Router`
  - select `Bluetooth subsystem support` if desired
    - select `Bluetooth device drivers`
      - select `HCI USB driver` if x86, depending on `USB`
      - select `HCI UART driver` if arm
      - select `Broadcom protocol support` if rpi, depending on `SERIAL_DEV_BUS`
      - select `Qualcomm Atheros protocol support` if msm, depending on `SERIAL_DEV_BUS`
- select `Device Drivers`
  - select `PCI support` if pci
    - select `PCI Express Port Bus support` if pcie
    - select `Message Signaled Interrupts (MSI and MSI-X)`
    - select `PCI controller drivers` if arm
      - select `DesignWare PCI Core Support` if newer msm
        - select `Qualcomm PCIe controller`
      - select `Broadcom Brcmstb PCIe host controller` if rpi
  - select `Generic Driver Options`
    - select `Maintain a devtmpfs filesystem to mount at /dev` (for systemd)
      - select `Automount devtmpfs at /dev, after the kernel mounted the rootfs`
    - select `Firmware loader`
      - select `Firmware loading facility`
        - select `Build named firmware blobs into the kernel binary` if built-in i915/amdgpu/etc
        - select `Enable compressed firmware support`
  - select `Firmware Drivers`
    - select `Mark VGA/VBE/EFI FB as generic system framebuffer` if x86
    - select `Raspberry Pi Firmware Driver` if rpi
    - select `Google Firmware Drivers` if cros
      - select `SMI interface for Google platforms` if x86
      - select `Coreboot Table Access`
      - select `Firmware Memory Console`
      - select `Vital Product Data`
  - select `Memory Technology Device (MTD) support`
    - select `SPI NOR device support`, depending on `SPI`
  - select `Block devices`
    - select `Compressed RAM block device support`
    - select `Loopback device support`
    - select `Virtio block driver` if guest, depending on `VIRTIO_PCI`
  - select `NVME Support` if needed
    - select `NVM Express block device`
  - select `Misc devices`
    - select `Intel Management Engine Interface` if intel
    - select `Intel HDCP2.2 services of ME Interface` if intel, depending on `DRM_I915`
    - select `Realtek PCI-E card reader` if needed
  - select `SCSI device support` if sata or usb mass storage
    - select `SCSI device support`
    - deselect `legacy /proc/scsi/ support`
    - select `SCSI disk support`
  - select `Serial ATA and Parallel ATA drivers (libata)` if needed
    - select `AHCI SATA support`
    - deselect `ATA SFF support (for legacy IDE and PATA)`
  - select `Multiple devices driver support (RAID and LVM)` if desired
    - select `Device mapper support`
  - select `Network device support`
    - select `Network core driver support`
      - select `Universal TUN/TAP device driver support` if kvm
      - select `Virtual ethernet pair device`
      - select `Virtio network driver` if guest, depending on `VIRTIO_PCI`
    - select `Ethernet driver support` if needed
      - deselect all but the desired drivers, such as
      - select `Broadcom devices` if rpi
        - select `Broadcom GENET internal MAC support`
      - select `Intel devices`
        - select `Intel(R) Ethernet Controller I225-LM/I225-V support`
    - select `Qualcomm IPA support` if msm modem, depending on `REMOTEPROC`, `QCOM_SYSMON`, `QCOM_WCNSS_PIL`, `RPMSG_QCOM_SMD`, `QCOM_AOSS_QMP`, and `INTERCONNECT`
    - select `USB Network Adapters`, depending on `USB`
      - select `Realtek RTL8152/RTL8153 Based USB Ethernet Adapters`
    - select `Wireless LAN` if needed
      - deselect all but the desired drivers, such as
      - select `Atheros/Qualcomm devices` if msm
        - select `Atheros 802.11ac wireless cards support`
        - select `Qualcomm ath10k SNOC support`
        - select `Qualcomm Technologies 802.11ax chipset support`, depending on `CRYPTO_MICHAEL_MIC`
          - select `Atheros ath11k AHB support`, depending on `REMOTEPROC`
      - select `Broadcom devices` if rpi
        - select `Broadcom FullMAC WLAN driver`
      - select `Intel devices` if intel
        - select `Intel Wireless WiFi Next Gen AGN - Wireless-N/Advanced-N/Ultimate-N (iwlwifi)`
          - select `Intel Wireless WiFi MVM Firmware support`
      - select `MediaTek devices`
        - select `MediaTek MT7921E (PCIe) support`
  - select `Input device support`
    - select `Generic input layer (needed for keyboard, mouse, ...)`
      - select `Event interface`
      - select `Keyboards`
        - select `ChromeOS EC keyboard` if cros, depending on `CROS_EC`
      - select `Mice`
        - deselect `PS/2 mouse`
        - select `ELAN I2C Touchpad support` if needed, depending on `I2C`
      - select `Touchscreens`
        - select `Elan eKTH I2C touchscreen` if needed, depending on `I2C`
      - select `Miscellaneous devices`
        - select `PC Speaker support` if desired
        - select `Windows-compatible SoC Button Array` if desired, depending on `KEYBOARD_GPIO`
  - select `Character devices`
    - select `Enable TTY`
      - deselect `Legacy (BSD) PTY support`
      - deselect `Allow legacy TIOCSTI usage`
      - select `Serial drivers`
        - select `8250/16550 and compatible serial support` if x86
          - select `Console on 8250/16550 and compatible serial port`
        - select `Support for Synopsys DesignWare 8250 quirks` if x86
        - select `QCOM on-chip GENI based serial port support` if msm, depending on `QCOM_GENI_SE`
          - select `QCOM GENI Serial Console support`
    - select `Virtio console` if guest
    - select `Hardware Random Number Generator Core support`
      - deselect all drivers
    - select `TPM Hardware Support`
      - select `TPM Interface Specification 1.2 Interface / TPM 2.0 FIFO Interface` if needed
      - select `TPM Interface Specification 2.0 Interface (I2C - CR50)` if cros, depending on `I2C`
      - select `TPM 2.0 CRB Interface` if needed
  - select `I2C support`
    - select `I2C support`
      - select `I2C Hardware Bus support`
        - select `Intel 82801 (ICH/PCH)` if intel
        - select `Intel PIIX4 and compatible (ATI/AMD/Serverworks/Broadcom/SMSC)` if x86
        - select `Broadcom BCM2835 I2C controller` if rpi
        - select `Synopsys DesignWare Platform` if x86, depending on `COMMON_CLK`
        - select `Qualcomm Technologies Inc.'s GENI based I2C controller` if msm, depending on `QCOM_GENI_SE`
        - select `ChromeOS EC tunnel I2C bus` if cros, depending on `CROS_EC`
  - select `SPI support`
    - select `BCM2835 SPI controller` if rpi
    - select `BCM2835 SPI auxiliary controller` if rpi
    - select `QTI QSPI controller` if msm
    - select `Qualcomm GENI based SPI controller` if msm
  - select `SPMI support` if msm
  - select `Pin controllers`
    - select `AMD GPIO pin control` if amd
    - select `Intel pinctrl drivers` if intel
      - select desired drivers such as
      - select `Intel Tiger Lake pinctrl and GPIO driver`
    - if msm
      - select `Qualcomm core pin controller driver`
      - select `Qualcomm SPMI PMIC pin controller driver`
      - select `Qualcomm Technologies Inc SC7180 pin controller driver`
      - select `Qualcomm Technologies Inc SC7280 pin controller driver`
      - select `Qualcomm Technologies Inc SC7280 LPASS LPI pin controller driver`, depending on `PINCTRL_LPASS_LPI`
      - select `Qualcomm Technologies Inc LPASS LPI pin controller driver`
  - select `Board level reset or power off` if msm
    - select `Qualcomm power-on driver`
  - select `Power supply class support`
    - select `SBS Compliant gas gauge`
    - select `ChromeOS EC based USBPD charger` if cros, depending on `CROS_EC`
  - select `Hardware Monitoring support`
    - select `AMD Family 10h+ temperature sensor` if amd
    - select `Dell laptop SMM BIOS hwmon driver` if dell
    - select `Intel Core/Core2/Atom temperature sensor` if intel
    - select `Raspberry Pi voltage monitor` if rpi
  - select `Thermal drivers`
    - select `Generic cpu cooling support` if arm
    - select `Generic device cooling support` if arm, depending on `PM_DEVFREQ`
    - select `Qualcomm thermal drivers` if msm
      - select `Qualcomm TSENS Temperature Alarm`, depending on `NVMEM` and `NVMEM_QCOM_QFPROM`
      - select `Qualcomm SPMI PMIC Thermal Monitor ADC5`, depending on `IIO`
      - select `Qualcomm SPMI PMIC Temperature Alarm`
    - select `Intel thermal drivers` if intel
      - select `ACPI INT340X thermal drivers`
        - select `ACPI INT340X thermal drivers`
    - select `Broadcom thermal drivers` if rpi
      - select `Thermal sensors on bcm2835 SoC`
  - select `Watchdog Timer Support`
    - select `AMD/ATI SP5100 TCO Timer/Watchdog` if amd
    - select `Intel TCO Timer/Watchdog` if intel
    - select `Intel MEI iAMT Watchdog` if intel
    - select `QCOM watchdog` if msm
    - select `Broadcom BCM2835 hardware watchdog` if rpi
  - select `Multifunction device drivers`
    - select `ChromeOS Embedded Controller multifunction device` if cros, depending on `CROS_EC`
    - select `Intel Low Power Subsystem support in PCI mode` if intel
    - select `Qualcomm SPMI PMICs` if msm
  - select `Voltage and Current Regulator Support` if arm
    - select `Fixed voltage regulator support`
    - select `ChromeOS EC regulators` if cros
    - select `Qualcomm Technologies, Inc. RPMh regulator driver` if msm, depending on `QCOM_COMMAND_DB` and `QCOM_RPMH`
    - select `GPIO regulator support` if rpi
  - select `Multimedia support` if desired
    - select `Media device types`
      - select `Cameras/video grabbers support`
      - select `Platform-specific devices` if arm
    - select `Media drivers`
      - select `Media USB Adapters`, depending on `USB`
        - select `USB Video Class (UVC)`
      - select `Media platform devices` if arm
        - select `Memory-to-memory multimedia devices`
        - select `Qualcomm Venus V4L2 encoder/decoder driver` if msm
  - select `Graphics support`
    - select `Direct Rendering Manager (XFree86 4.1.0 and higher DRI support)`
    - select `AMD GPU` if amd
      - select `Always enable userptr write support`
    - select `Intel 8xx/9xx/G3x/G4x/HD Graphics` if intel
    - select `MSM DRM` if msm
    - select `Virtio GPU driver` if guest
    - select `Broadcom VC4 Graphics` if rpi, depending on `SND_SOC`
      - it requires `CMA` and `DMA_CMA` to work
    - select `Display Panels` if arm
      - select `support for simple panels (other than eDP ones)`, depending on `BACKLIGHT_CLASS_DEVICE`
      - select `support for simple Embedded DisplayPort panels`, depending on `BACKLIGHT_CLASS_DEVICE`
    - select `Display Interface Bridges` if arm
      - select `Display connector support`
      - select `TI SN65DSI86 DSI to eDP bridge`
    - select `Simple framebuffer driver` if desired
    - select `Frame buffer Devices`
      - select `Support for frame buffer devices`
        - select `Simple framebuffer support` if legacy driver is desired
    - select `Backlight & LCD device support`
      - select `Lowlevel Backlight controls`
        - select `Generic PWM based Backlight Driver` if arm, depending on `PWM`
  - select `Sound card support` if desired
    - select `Advanced Linux Sound Architecture`
      - deselect `Support old ALSA API`
      - select `HD-Audio` if x86
        - select `HD Audio PCI`
        - select `Build Realtek HD-audio codec support` if needed
        - select `Build HDMI/DisplayPort HD-audio codec support` if needed
      - select `ALSA for SoC audio support` if desired
        - select `AMD Audio Coprocessor-v6.x Yellow Carp support` if amd
          - select `AMD YC support for DMIC`
        - select `AMD Audio ACP Common support` if amd
          - select `AMD ACP ASOC Rembrandt Support`
        - deselect `Intel ASoC SST drivers`
        - select `Intel Machine drivers` if intel
          - select `Skylake+ with HDA Codecs`, depending on `SND_SOC_SOF_HDA_AUDIO_CODEC`
        - select `ASoC support for QCOM platforms` if msm
          - select `SoC Machine driver for SC7180 boards`
          - select `SoC Machine driver for SC7280 boards`, depending on `SOUNDWIRE`
        - select `Sound Open Firmware Support` if x86
          - select `SOF PCI enumeration support`
          - select `SOF support for AMD audio DSPs` if amd
            - select `SOF support for REMBRANDT`
          - select `SOF support for Intel audio DSPs` if intel
            - deselect all but desired drivers such as
            - select `SOF support for Tigerlake`
            - select `SOF support for HDA Links(HDA/HDMI)`
              - select `SOF support for HDAudio codecs`
        - select `CODEC drivers` if msm
          - select `Qualcomm VA Macro in LPASS(Low Power Audio SubSystem)`
          - select `Qualcomm RX Macro in LPASS(Low Power Audio SubSystem)`
          - select `Qualcomm TX Macro in LPASS(Low Power Audio SubSystem)`
  - select `HID bus support`
    - select `HID bus core support`
      - select `Special HID drivers`
        - deselect all but the desired drivers, such as
        - select `Google Hammer Keyboard`, depending on `CROS_EC` and `LEDS_CLASS`
        - select `Logitech devices`
          - select `Logitech receivers full support`, depending on `HIDRAW`
          - select `Logitech HID++ devices support`
        - select `HID Multitouch panels`
        - select `Nintendo Joy-Con and Pro Controller support`
        - select `Wacom Intuos/Graphire tablet support (USB)`
        - select `HID Sensors framework support`
    - select `I2C HID support`
      - select `HID over I2C transport layer ACPI driver` if x86 (for I2C touchpads)
      - select `HID over I2C transport layer Open Firmware driver` if arm
      - select `Driver for Goodix hid-i2c based devices on OF systems` if needed
    - select `AMD SFH HID Support` if amd
      - select `AMD Sensor Fusion Hub`
  - select `USB support`
    - select `Support for Host-side USB`
    - select `xHCI HCD (USB 3.0) support`
    - select `EHCI HCD (USB 2.0) support` if needed
    - select `USB Printer support` if needed
    - select `USB Mass Storage support`
    - select `DesignWare USB3 DRD Core Support` if msm
    - select `Onboard USB hub support` if msm
    - select `USB Type-C Support`
      - select `USB Type-C Port Controller Manager`
      - select `USB Type-C Connector System Software Interface driver`
        - select `UCSI ACPI Interface Driver` if x86
      - select `USB Type-C Multiplexer/DeMultiplexer Switch support`
        - select `Intel PMC mux control` if intel, depending on `INTEL_SCU_PLATFORM`
  - select `MMC/SD/SDIO card support` if desired
    - select `Secure Digital Host Controller Interface support`
      - select `SDHCI platform and OF driver helper` if arm
    - select `SDHCI support for the BCM2835 & iProc SD/MMC Controller` if rpi
    - select `Qualcomm SDHCI Controller Support` if msm
    - select `Realtek PCI-E SD/MMC Card Interface Driver` if needed, depending on `MISC_RTSX_PCI`
  - select `LED Support`
    - select `LED Class Support`
    - select `LED support for Qualcomm LPG` if newer msm, depending on `LEDS_CLASS_MULTICOLOR`
  - select `EDAC (Error Detection And Correction) reporting (NEW)`, depending on `RAS`
    - deselect `EDAC legacy sysfs`
    - select `Intel client SoC Integrated MC` if intel
    - select `QCOM EDAC Controller` if msm, depending on `QCOM_LLCC`
  - select `Real Time Clock`
    - select `Chrome OS EC RTC driver` if cros, depending on `CROS_EC`
  - select `DMA Engine support`
    - select `Intel integrated DMA 64-bit support` if intel
    - select `Synopsys DesignWare AHB DMA platform driver` if intel
    - select `BCM2835 DMA engine support` if rpi
  - select `DMABUF options`
    - select `userspace dmabuf misc driver`
  - select `Virtio drivers` if guest
    - select `PCI driver for virtio devices`
    - select `Virtio input driver`
  - select `VHOST drivers` if kvm
    - select `Host kernel accelerator for virtio net`
    - select `vhost virtio-vsock driver`
  - select `Staging drivers`
    - select `Broadcom VideoCore support` if rpi
      - select all
  - select `Platform support for Chrome hardware` if cros
    - select `Chrome OS Laptop`
    - select `Chrome OS pstore support`
    - select `ChromeOS Tablet Switch Controller`
    - select `ChromeOS Embedded Controller`
      - select `ChromeOS Embedded Controller (rpmsg)` if msm
      - select `ChromeOS Embedded Controller (I2C)` if x86
      - select `ChromeOS Embedded Controller (SPI)`
      - select `ChromeOS Embedded Controller (UART)` if amd, depending on `SERIAL_DEV_BUS`
      - select `ChromeOS Embedded Controller (LPC)` if x86
    - select `Backlight LED support for Chrome OS keyboards`
    - select `ChromeOS Privacy Screen support`
  - select `X86 Platform Specific Device Drivers` if x86
    - select `WMI`
    - select `Dell X86 Platform Specific Device Drivers` if dell
    - select `Lenovo IdeaPad Laptop Extras` if ideapad
    - select `ThinkPad ACPI Laptop Extras` if thinkpad
    - select `Lenovo WMI-based systems management driver` if thinkpad
    - select `Intel PMC Core driver` if intel
    - select `Intel HID Event` if intel
    - select `Intel Vendor Specific Extended Capabilities Driver` if intel
    - select `Intel SCU platform driver` if intel
  - select `Common Clock Framework`
    - select `Support for Qualcomm's clock controllers` if msm
      - select `RPMh Clock Driver`
      - select SC7180*
      - select SC7280*
    - select `Broadcom BCM2835 clock support` if rpi
    - select `Raspberry Pi firmware based clock support` if rpi
  - select `Hardware Spinlock drivers` if msm
    - select `Qualcomm Hardware Spinlock device`
  - select `Mailbox Hardware Support`
    - select `Qualcomm APCS IPC driver` if msm
    - select `Qualcomm Technologies, Inc. IPCC driver` if msm
    - select `BCM2835 Mailbox` if rpi
  - select `IOMMU Hardware Support`
    - select `ARM Ltd. System MMU (SMMU) Support` if msm
    - select `Support for Intel IOMMU using DMA Remapping Devices` if intel
    - select `Support for Interrupt Remapping` if kvm
    - select `Virtio IOMMU driver` if guest
  - select `Remoteproc drivers` if msm
    - select `Support for Remote Processor subsystem`
      - select `Qualcomm Technology Inc ADSP Peripheral Image Loader`
      - select `Qualcomm Hexagon V5 self-authenticating modem subsystem support`
      - select `Qualcomm sysmon driver`
      - select `Qualcomm WCNSS Peripheral Image Loader` if modem
  - select `Rpmsg drivers` if msm
    - select `Qualcomm SMEM Glink driver`
    - select `Qualcomm Shared Memory Driver` if modem
  - select `SoundWire support` if msm
    - select `Qualcomm SoundWire Master driver`
  - select `SOC (System On Chip) specific Drivers`
    - select `Broadcom SoC drivers` if rpi
      - select `Raspberry Pi power domain driver`
    - select `Qualcomm SoC drivers` if msm
      - select all
  - select `Generic Dynamic Voltage and Frequency Scaling (DVFS) support` if arm
    - select `Simple Ondemand`
    - select `Performance`
    - select `DEVFREQ-Event device Support`
  - select `Industrial I/O support`
    - select `Accelerometers`
      - select `HID Accelerometers 3D` if desired (tablets, 2-in-1s)
    - select `Analog to digital converters`
      - select `Qualcomm Technologies Inc. SPMI PMIC5 ADC` if msm
    - select `ChromeOS EC Sensors Core` if cros
      - select `ChromeOS EC Contiguous Sensors`
      - select `ChromeOS EC Sensor for lid angle`
    - select `Proximity and distance sensors`
      - select `ChromeOS EC MKBP Proximity sensor` if cros
      - select `SX9310/SX9311 Semtech proximity sensor` if needed
      - select `SX9324 Semtech proximity sensor` if needed
  - select `Pulse-Width Modulation (PWM) Support` if arm
    - select `ChromeOS EC PWM driver` if cros
    - select `BCM2835 PWM support` if rpi
  - select `IRQ chip support` if msm
    - select `QCOM PDC`
  - select `Reset Controller Support` if arm
    - select `Qcom AOSS Reset Driver` if msm
    - select `Qualcomm PDC Reset Driver` if msm
    - select `Raspberry Pi 4 Firmware Reset Driver` if rpi
  - select `PHY Subsystem` if msm
    - select `Qualcomm eDP PHY driver`
    - select `Qualcomm QMP PHY Driver`
    - select `Qualcomm QUSB2 PHY Driver`
    - select `Qualcomm SNPS FEMTO USB HS PHY V2 module`
  - select `Generic powercap sysfs driver` if x86
    - select `Intel RAPL Support via MSR Interface` if intel/amd
  - select `Reliability, Availability and Serviceability (RAS) features`
  - select `Unified support for USB4 and Thunderbolt` if needed
  - select `NVMEM Support`
    - select `QCOM QFPROM Support` if msm
  - select `Trusted Execution Environment support` if arm
    - select `OP-TEE`
  - select `On-Chip Interconnect management support` if msm
    - select `Qualcomm Network-on-Chip interconnect drivers`
    - select `Qualcomm OSM L3 interconnect driver`
    - select `Qualcomm SC7180 interconnect driver`
    - select `Qualcomm SC7280 interconnect driver`
- select `Cryptographic API`
  - select `Hardware crypto devices`
    - select `Support for AMD Secure Processor` if amd
      - select `Secure Processor device driver`
        - select `Cryptographic Coprocessor device`
          - deselect `Encryption and hashing offload support` if raven (boot issue)

## Config: Built-in Firmwares

- chromebooks
  - <https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay/+/refs/heads/main/eclass/cros-kernel2.eclass>
  - grunt: `builtin_fw_amdgpu_stoney`
  - zork: `builtin_fw_amdgpu_picasso` and `builtin_fw_amdgpu_raven2`
  - guybrush: `builtin_fw_amdgpu_green_sardine` and
              `builtin_fw_amdgpu_renoir`
  - skyrim: `builtin_fw_amdgpu_gc_10_3_7` and
            `builtin_fw_amdgpu_yellow_carp`
  - brya: `builtin_fw_guc_adl`, `builtin_fw_huc_adl`,
          `builtin_fw_x86_adl_ucode`, and `builtin_fw_x86_rpl_ucode`
